import{aE as St,P as Ve,aC as Oe,r as _,O as Ie,o as X,i as Q,a4 as H,aD as J,u as q,b as P,e as F,F as bt,g as re,w as Z,f as ae,T as Ge,c as _t,t as se,q as Mt,Y as xt,D as Bt,aF as At,d as Et,h as Ft,aG as $t}from"./index-CpDLmces.js";import{g as he,V as Vt,f as G,S as z,C as ye,F as U,a as W,W as Ot,X as It,M as Gt,d as zt,D as ee,b as I,c as A,P as Le,e as O,t as de,h as Rt,i as Zt,j as qt,k as jt,Z as Nt,l as Ut,m as Wt,n as Xt,o as Kt,p as Yt,q as K,r as Ht,T as ze,L as Jt,K as Qt,s as en,O as Re,I as Ze,u as tn,v as nn}from"./gis-5hqJi7FC.js";import{m as w}from"./mittBus-rOgeEvW-.js";import on from"./DemoPopupDetailDialog-0weu7fKv.js";import{_ as me}from"./plugin-vueexport-helper-DlAUqK2U.js";import rn from"./index-CimXNjLG.js";const qe={commonMenu:{commonMenuMethod1:"拷贝当前经纬度",commonMenuMethod3:"切换天地图token"},commonDynamicMenu:{commonDynamicMenuMethod1:"清除所有要素",commonDynamicMenuMethod2:"显示当前要素信息",commonDynamicMenuMethod3:"仅取消绘制状态",commonDynamicMenuMethod4:"展示分析结果",commonDynamicMenuMethod5:"删除所有绘制内容"},singleMenu:{singleMenuMethod1:"刷新地图",singleMenuMethod2:"清除POI点"}},{commonMenu:xe}=qe;let je=[];for(let e in xe)je.push(xe[e]);const E={menuMethodBtn:qe,commonMenuMethodsArr:je,setMenuMethods(e,t,o,n,s){let i=te(n);const{commonMenu:l,commonDynamicMenu:u,singleMenu:c}=this.menuMethodBtn;switch(t){case l.commonMenuMethod0:Bn(e,o,n);break;case l.commonMenuMethod01:xn(e,n);break;case"清空自定义标注点":R(e,h=>h.get("tempType")==="myPointByMenu");break;case l.commonMenuMethod02:at(e,n);break;case"清空自定义闪烁点":document.querySelectorAll(".flicker_point").forEach(h=>{h.classList.remove("flicker_point")});break;case l.commonMenuMethod1:St(`[${i}]`,()=>{Ve.success(`[${i}] 拷贝成功`)});break;case l.commonMenuMethod2:Qe(e,o);break;case l.commonMenuMethod3:w.emit("showSetTokenDialog");break;case u.commonDynamicMenuMethod1:Ce(e);break;case u.commonDynamicMenuMethod2:w.emit("singleFeaturesClick",{feature:o,pixelPoint:n});break;case u.commonDynamicMenuMethod3:Te(e);break;case u.commonDynamicMenuMethod4:let C=o.get("pointData");w.emit("analysisPointData",C);break;case u.commonDynamicMenuMethod5:R(e,h=>h.get("drawType"));break;case c.singleMenuMethod1:w.emit("reflashMap");break;case c.singleMenuMethod2:nt(e,"POIMarker");break}},setMentBtnExtendByPage(e){const{singleMenu:t}=this.menuMethodBtn;switch(e){case"gis":le(t.singleMenuMethod1),le(t.singleMenuMethod2);break}}};let an=0,ve="6b94eac741fe8a50f283b9b11d9d60d2";const Be=he(),V=(e,t=!0)=>(Be.mapToken!==""&&(ve=Be.mapToken),t?e+ve:e),Ne=(e,t={},o={})=>new Ot({source:new It({url:e,crossOrigin:"anonymous",...t}),type:"baseLayer",url:e,...o}),Ue=e=>Ne(e,{wrapX:!1},{layerType:"baseMapLayer"}),ke=e=>Ne(e,{},{layerType:"baseMapTxt"}),pe={getBaseMapLayer(e){switch(e){case"empty":return V("/xxx/{z}/{y}/{x}.png",!1);case"t0vec":return V("http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=");case"t3img":return V("http://t3.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=");case"t4ter":return V("http://t4.tianditu.com/DataServer?T=ter_w&x={x}&y={y}&l={z}&tk=");case"t07vec":return V("http://t{0-7}.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=");case"t07img":return V("http://t{0-7}.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=")}},getBaseMapTxt(e){switch(e){case"empty":return V("",!1);case"t0cva":return V("http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=");case"t4cva":return V("http://t4.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=");case"t07cia":return V("http://t{0-7}.tianditu.com/DataServer?T=cia_w&x={x}&y={y}&l={z}&tk=");case"t07cva":return V("http://t{0-7}.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=")}}},we=15,Ae={layers:[Ue(pe.getBaseMapLayer("t3img")),ke(pe.getBaseMapTxt("t07cia"))],view:new Vt({center:G([121.63,29.88]),zoom:16,maxZoom:17,minZoom:13,constrainResolution:!0,smoothResolutionConstraint:!1})},N=(e,t)=>{e&&(e instanceof Array?(e.length!==0&&le(t),e.length===0&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(o=>o!==t))):e instanceof O?e.get("tempType")||le(t):(le(t),e.length===0&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(o=>o!==t)))),!e&&E.commonMenuMethodsArr.includes(t)&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(o=>o!==t))},We=new z({image:new ye({radius:5,fill:new U({color:"#f49d41"}),stroke:new W({color:"#836365",width:1})})}),Xe=(e,t)=>new z({image:new Ze({src:t,anchor:[.8,80],anchorOrigin:"top-right",anchorXUnits:"fraction",anchorYUnits:"pixels",offsetOrigin:"top-left",size:[100,100],offset:[3,-32],scale:e.getView().getZoom()/30,opacity:.75})}),sn=(e,t,o,n,s)=>{let i=360-n,l=Math.PI*(1/o-1/2);l+=i/180*Math.PI;let u,c,p,C=[];for(let v=0;v<o;++v){let k=v*((360-i)/360);u=l+k*2*Math.PI/o,c=e[0]+t*Math.cos(u),p=e[1]+t*Math.sin(u),C.push([c,p])}C.push(e);let h=new tn(C);h.rotate(s/57.3,e);let D=h.getCoordinates();return new Le([D])},Ke=()=>{document.querySelectorAll(".flicker_point").forEach(t=>{t.classList.remove("flicker_point")})},ln=e=>{e&&(e.getLayers().forEach(function(t){t.setMap(null)}),e.setView(null),e.setTarget(null),e=null)},cn=e=>new Gt({target:e,layers:Ae.layers,view:Ae.view,interactions:zt({mouseWheelZoom:!0})}),un=(e,t)=>{let o="";switch(t){case"empty":o="empty";break;case"t0vec":o="t0cva";break;case"t3img":o="t07cia";break;case"t4ter":o="t4cva";break}let n=Ue(pe.getBaseMapLayer(t)),s=ke(pe.getBaseMapTxt(o));n.values_.url,s.values_.url;const i=e.getLayers();e.getAllLayers().forEach((l,u)=>{if(l.get("type")==="baseLayer")switch(l.get("layerType")){case"baseMapLayer":e.removeLayer(l),i.insertAt(u,n);break;case"baseMapTxt":if(s!==""&&(e.removeLayer(l),i.insertAt(u,s)),s===""){let c=ke("");e.removeLayer(l),i.insertAt(u,c)}break}})},dn=e=>{const t=e.getView().calculateExtent(e.getSize()),o=qt(t),n=jt(t),s=de(o,"EPSG:3857","EPSG:4326"),i=de(n,"EPSG:3857","EPSG:4326");return{topLeft:s,bottomRight:i}},pn=e=>{e.getControls().clear(),e.addControl(new Nt),e.addControl(new Ut),e.addControl(new Wt)},le=e=>{E.commonMenuMethodsArr.includes(e)||E.commonMenuMethodsArr.push(e)},Ye=e=>{let t=document.querySelector(".ol_map_wrap"),o=document.querySelector(".menu_wrap");o&&t.removeChild(o),e&&e(t)},gn=(e,t,o)=>{const{commonDynamicMenu:n,singleMenu:s}=E.menuMethodBtn;e.getViewport().addEventListener("contextmenu",i=>{var S;i.preventDefault(),o(m=>{E.setMentBtnExtendByPage(m)});const l=e.getEventCoordinate(i),u=e.getPixelFromCoordinate(l),c=e.forEachFeatureAtPixel(u,m=>m);let p=[],C=[],h=[],D=[];De(e,m=>{let d=m.getSource().getFeatures()[0];d&&(p.push(d),d.get("tempType")==="myPointByMenu"&&C.push(d),d.get("businessType")==="POIMarker"&&h.push(d),d.get("drawType")&&D.push(d))}),N(p,n.commonDynamicMenuMethod1),N(c,n.commonDynamicMenuMethod2);const v=ge(e);N(v,n.commonDynamicMenuMethod3),N(C,"清空自定义标注点");let k=document.querySelectorAll(".flicker_point");N(k,"清空自定义闪烁点"),c&&(S=c.get("pointData"))!=null&&S.isNeedAnalysis&&N(c,n.commonDynamicMenuMethod4),N(D,n.commonDynamicMenuMethod5),N(h,s.singleMenuMethod2),Ye(m=>{let d=null;d=document.createElement("div"),d.setAttribute("class","menu_wrap");let f="";E.commonMenuMethodsArr.forEach(T=>{f+=`<li>${T}</li>`}),d.innerHTML=`
      <ul>
        ${f}
      </ul>
    `,d.style.position="fixed",d.style.left=`${i.clientX}px`,d.style.top=`${i.clientY}px`,m.appendChild(d),d.addEventListener("click",T=>{const B=T.target.textContent;t({option:B,feature:c,pixelPoint:l}),m.removeChild(d)})})})},ge=e=>e.getInteractions().getArray().find(t=>t instanceof ee),Te=e=>{const t=ge(e);e.removeInteraction(t)},te=e=>de(e,"EPSG:3857","EPSG:4326"),yn=(e,t)=>G([e,t]),Pe=e=>Xt(Kt(e)),mn=e=>{const t=e.getGeometry();if(t.getType()==="Polygon"){const o=t.clone();o.transform("EPSG:3857","EPSG:4326");const n=o.getExtent();return Yt(n)}return null},fn=(e,t,o="/",n={},s=1)=>{const i=new A({features:[]}),l=new I({source:i,zIndex:s,style:o==="/"?We:Xe(e,o)});e.addLayer(l);const u=(c,p)=>({geometry:c,type:"Marker",pointData:p,...n});if(t instanceof Array)t.forEach(c=>{const p=new K(G(c.lonlat)),C=new O({...u(p,c.pointData)});i.addFeature(C)});else{const c=new K(G(t.lonlat)),p=new O({...u(c,t.pointData)});i.addFeature(p)}},wn=(e,t,o)=>{let n=new A;if(t instanceof Array)t.forEach(l=>{let u=G([l.longitude,l.latitude]),c=new O({geometry:new K(u),type:"Marker",pointData:l});n.addFeature(c)});else{let l=G([t.longitude,t.latitude]),u=new O({geometry:new K(l),type:"Marker",pointData:t});n.addFeature(u)}let s=new Ht({source:n,distance:50}),i=new I({type:"clusterLayer",source:s,style:function(l){l.set("type","Cluster");let u=l.get("features").length;return u===1?o==="/"?We:Xe(e,o):new z({image:new ye({radius:30,stroke:new W({color:"white"}),fill:new U({color:"blue"})}),text:new ze({text:u.toString(),fill:new U({color:"white"})})})}});e.addLayer(i)},He=(e,t,o={},n)=>{const s=new O({geometry:new Jt(t),type:"Line",...o});s.setStyle(n);const i=new A({features:[s]}),l=new I({source:i,zIndex:9});e.addLayer(l)},ne=(e,t,o=!1,n=2,s=5)=>new z(o?{image:new ye({radius:s,fill:new U({color:e}),stroke:new W({color:t,width:n})})}:{fill:new U({color:e}),stroke:new W({color:t,width:n})}),Je=()=>ne("rgba(32, 157, 230, 0.2)","rgb(64 158 255)"),Qe=(e,t)=>{let o=null;switch(t.get("type")){case"Marker":o=ne("#409eff","#f00",!0,2,10);break;case"Curve":o=ne("#409eff","#f00",!1,5);break}t.setStyle(o),t.set("temp",!0);let n=new I({source:new A,zIndex:999});R(e,s=>s.get("temp")),n.setOpacity(1),n.getSource().addFeature(t),e.addLayer(n)},et=(e,t,o,n={},s)=>{const i=new z({text:new ze({text:t,fill:new U({color:"#333333"}),font:"18px pingfang",textAlign:"center",textBaseline:"bottom",padding:[5,10,5,10],offsetX:-20,offsetY:-13,overflow:!0,rotateWithView:!1,rotation:0})});s&&R(e,c=>s(c));const l=new O({geometry:new K(G(o)),type:"textPoint",...n});l.setStyle(i);const u=new I({source:new A({features:[l]}),zIndex:9});e.addLayer(u)},tt=(e,t,o,n,s=null)=>{let i=document.getElementById("popup"),l=document.getElementById("popup-closer");i.style.display="block";let u=new Re({element:i,...s,zIndex:9999});e.addOverlay(u),l.onclick=()=>(u.setPosition(void 0),l.blur(),u=null,!1),u.setPosition(t),u.getElement().onclick=c=>{n(c)}},Ee=(e,t,o)=>{let n=[];t.forEach(l=>{let u=ne("rgba(32, 222, 230, 0.4)","rgba(255, 205, 67, 0.3)"),c=100;if(o){let{myCurveStyle:D,myCurveRadius:v}=o(l);u=D,c=v}let p=G(l.lonlat),C=sn(p,c,100,45,l.curveData.antDirectionAngle),h=new O(C);h.setStyle(u),h.set("type","Curve"),h.set("curveData",l.curveData),n.push(h)});let s=new A;s.addFeatures(n);let i=new I({source:s,zIndex:1});e.addLayer(i)},Fe=(e,t,o,n)=>{tt(e,t,o,n,{autoPan:!0})},hn=(e,t,o)=>{const s={name:"通用信息展示弹窗",hdms:Pe(e),coordinate:[t.longitude,t.latitude],popupData:t};o(s)},De=(e,t)=>{let o=e.getLayers().getArray();for(let n=o.length-1;n>=0;--n)o[n]instanceof I&&t(o[n])},Ce=e=>{Ke(),Te(e),De(e,t=>{e.removeLayer(t)})},R=(e,t)=>{De(e,o=>{let n=o.getSource().getFeatures()[0];t(n)&&e.removeLayer(o)})},vn=(e,t)=>{R(e,o=>{if(o)return o.get("type")===t})},nt=(e,t)=>{R(e,o=>{if(o)return o.get("businessType")===t})},$e=e=>{R(e,t=>{if(t)return(t.get("type")==="Marker"||t.get("type")==="Curve"||t.get("type")==="Cluster")&&!t.get("bussinessType")})},kn=e=>{R(e,t=>{if(t)return t.get("tempType")}),Ke()},Pn=(e,t)=>{e.getView().animate({center:G(t),duration:800})},Cn=(e,t)=>{e.getLayers().forEach(o=>{let n=null;o&&(n=o.getSource()),n instanceof A&&n.forEachFeature(s=>{t(s)})})},Ln=(e,t)=>{const n=new Qt({extractStyles:!1}).readFeatures(t);n.forEach(i=>{i.getGeometry().transform("EPSG:4326","EPSG:3857")});const s=new A({features:n});e.getView().fit(s.getExtent()),e.getLayers().push(new I({source:s,style:ne("blue","red"),zIndex:100}))},Tn=e=>{e.addInteraction(new ee({source:new A,type:"Polygon"})),e.getInteractions().getArray().forEach(t=>{t instanceof ee&&t.on("drawend",o=>{const{feature:n}=o,s=n.getGeometry(),i=s.getCoordinates()[0],l=s.transform("EPSG:3857","EPSG:4326").getCoordinates()[0];s instanceof Le&&(ot(e,{coords:i,lonlat:l},{drawType:"polygon"}),e.removeInteraction(t))})})},ot=(e,{coords:t,lonlat:o,polygonData:n},s={},i,l=Je())=>{let u=new O({geometry:new Le([t]),type:"Polygon",...s,polygonData:{coords:t,lonlat:o,...n}});u.setStyle(l);let c=new I({source:new A({features:[u]})});e.addLayer(c),i&&i(u)},Dn=e=>{},Sn=e=>{e.addInteraction(new ee({source:new A,type:"Circle"})),e.getInteractions().getArray().forEach(t=>{t instanceof ee&&t.on("drawend",o=>{const{feature:n}=o,s=n.getGeometry();let l={lonlat:de(s.getCenter(),"EPSG:3857","EPSG:4326"),radius:s.getRadius()};rt(e,l,{drawType:"Circle"}),e.removeInteraction(t)})})},rt=(e,t,o={},n,s=!1)=>{t.radius||(t.radius=550);let i=[],l=new O({type:"Circle",...o,circleData:t,geometry:new Rt(G(t.lonlat),t.radius)});l.setStyle(s?new z({fill:new U({color:"rgba(255, 0, 0, 0)"}),stroke:new W({color:"#f00",color:"rgba(255, 0, 0, 0)"})}):Je()),i.push(l);let u=new A;u.addFeatures(i);let c=new I({zIndex:100});if(c.setSource(u),e.addLayer(c),n){let p=0;c.on("postrender",C=>{p>=20&&(p=0);var h=(20-p)*(1/20),D=new z({radius:p,stroke:new W({color:"rgba(255,60,5"+h+")",width:18-p/1.5})});let v=en(C);v.setStyle(D),v.drawGeometry(l.getGeometry()),p=p+.2,e.render()})}},bn=(e,t)=>{let o=new ee({source:new A,type:"LineString"});e.addInteraction(o),o.on("drawend",n=>{const{feature:s}=n,i=s.getGeometry();let l=Zt(i);l=l.toFixed(2);const u=i.getCoordinates(),c=i.transform("EPSG:3857","EPSG:4326").getCoordinates();t&&t(l),He(e,u,{drawType:"TestDistance"}),et(e,l+"米",c[0],{drawType:"TestDistance"})})},_n=e=>{R(e,t=>{t.get("drawType")})},Mn=(e,t,o="../src/components/OpenlayerBaseMap/icon/routearrow.svg",n="arrowLine")=>{function s(i){const l=i.getGeometry(),u=l.getLength();let p=50*e.getView().getResolution(),C=Math.floor(u/p);const h=[new z({stroke:new W({color:"#42b983",width:6})})],D=[],v=[0];l.forEachSegment(function(k,S){let m=S[0]-k[0],d=S[1]-k[1],f=Math.atan2(d,m);v.unshift(Math.sqrt(m**2+d**2)+v[0]),D.push(f)});for(let k=1;k<C;k++){let S=l.getCoordinateAt(k*1/C);const m=k*p,d=v.findIndex(f=>f<=m);h.push(new z({geometry:new K(S),image:new Ze({src:o,opacity:1,anchor:[.5,.5],rotateWithView:!0,rotation:-D[v.length-d-1],scale:.8})}))}return h}He(e,t,{businessType:n},s)},xn=(e,t)=>{const o=[],n=new O({geometry:new K(t),name:an++,location:t,tempType:"myPointByMenu"}),s=new z({image:new ye({radius:15,fill:new U({color:"#409eff"}),stroke:new W({color:"#4440ff",width:1})})});n.setStyle(s),o.push(n);const i=new A({features:o}),l=new I({source:i,opacity:.8});e.addLayer(l)},at=(e,t,o="",n)=>{let s=document.createElement("div");s.className=`flicker_point ${o}`;let i=new Re({element:s,position:t,zIndex:0});e.addOverlay(i),n&&s.addEventListener("click",()=>{n()})},Bn=(e,t,o)=>{te(o)},st=()=>document.querySelector("#popup-content"),ie=(e,t)=>{w.emit("setCommonPopupInner",{popupObj:e,featureItem:t,callback:o=>{Oe(o,st())}})},ue=(e,t)=>{let o=[];w.emit("setFeaturesPopupInner",{popupObj:e,callback:n=>{Oe(n,st())},next:n=>{o=n}}),t&&t(o)},An={id:"popup",class:"ol-popup popup_toggle"},En={__name:"PopupCommon",props:{currentPageType:{type:String,default:""}},setup(e,{expose:t}){let o=_(!1),n={},s=_(null);const i=e;w.on("showPopupDialog",m=>{u(m,i.currentPageType)}),w.on("getSingleByFeatures",({unique:m,itemData:d})=>{let f=m.split(":");const{arrData:T}=d;n.arrData=T,T.forEach(B=>{B[f[0]]===f[1]&&(n.currentPopupData=B,ie(n),l(n))})}),w.on("popupBack",()=>{n.popupData=n.arrData,n.noFeature=!0,ue(n)});const l=m=>{let d=document.getElementById("popup-content");ie(m);const f=document.createElement("b");f.setAttribute("data-function","popupBack"),f.setAttribute("id","popupBack"),f.setAttribute("title","返回"),f.innerHTML="",d.appendChild(f)},u=(m,d)=>{switch(d){case"demo":Ie(()=>{s.value.show(m)});break}},c=()=>{o.value=!0},p=()=>{o.value=!1},C=(m,d,f,T)=>{let B=document.querySelector("#popupBack");B&&T&&!T.get("businessType")&&B.remove();let j=te(d);const $={name:"通用信息展示弹窗",hdms:Pe(d),coordinate:j,popupData:f};n=$,w.emit("fixCommonPopupData",$),Fe(m,d,ie($,T),fe=>{D(fe)})},h=(m,d,f)=>{let T=te(d),B=Pe(d),j=[];f.forEach($=>{switch($.get("type")){case"Marker":j.push("标注点");break;case"Curve":j.push("扇区");break}});const oe={name:j.length+"个重叠要素",type:Array.from(new Set(j)).join(","),hdms:B,coordinate:T,popupData:f};n=oe,Fe(m,d,ue(oe,$=>{n.currentDataList=$}),$=>{D($)})},D=async m=>{const{target:d}=m;let f=d.getAttribute("data-function");f==="getMore"&&S(),f==="getSingleByFeatures"&&v(d.getAttribute("data-unique")),f==="popupBack"&&k()},v=m=>{if(!m)return;let d=m.split(":");const f=(T,B)=>{if(!T.get("noPopup")&&T.get(B)[d[0]]===d[1])return n.currentPopupData=T.get(B),T};n.currentPopupFeature=n.popupData.filter(T=>{switch(T.get("type")){case"Marker":return f(T,"pointData");case"Curve":return f(T,"curveData")}}),l(n,n.currentPopupFeature[0])},k=()=>{n.popupData instanceof Array&&ue(n)},S=()=>{w.emit("popupDataGetMore",{currentPopupObj:n,callback:m=>{u(m,i.currentPageType)}})};return t({showPopup:c,hidePopup:p,setCommonPopup:C,setFeaturesPopup:h}),(m,d)=>(X(),Q(bt,null,[H(P("div",An,d[0]||(d[0]=[P("div",{class:"popup_wrap"},[P("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"}),P("div",{id:"popup-content",class:"popup-content"})],-1)]),512),[[J,q(o)]]),F(on,{ref_key:"refDemoPopupDetailDialog",ref:s},null,512)],64))}},Fn=me(En,[["__scopeId","data-v-9b0f878b"]]),$n={class:"lend_wrap"},Vn={class:"lent_tb_wrap"},On=["title"],In={__name:"Lend",props:{currentPageType:{type:String,default:""},isShowLend:{type:Boolean,default:!0}},setup(e){w.on("showLend",()=>{t.value=!0});let t=_(!1);const o=()=>{t.value=!t.value};return(n,s)=>H((X(),Q("section",$n,[H(P("div",Vn,[H(F(rn,null,null,512),[[J,e.currentPageType==="demo"]])],512),[[J,q(t)]]),P("div",{class:"toggle",title:`点击${q(t)?"隐藏":"显示"}图例`,onClick:o},null,8,On)],512)),[[J,e.isShowLend]])}},Gn=me(In,[["__scopeId","data-v-ce8fc5de"]]),zn={class:"switch_base_layer_wrap"},Rn={class:"switch_content"},Zn=["title"],qn={__name:"SwitchBaseLayer",emits:["switchBaseLayerType"],setup(e,{emit:t}){w.on("resetSwitchLayer",()=>{s.value.layerType="t3img"});const o=t;let n=_(!1);const s=_({layerType:"t3img"}),i=()=>{n.value=!n.value},l=u=>{o("switchBaseLayerType",u)};return(u,c)=>{const p=re("el-radio"),C=re("el-radio-group");return X(),Q("section",zn,[H(P("div",Rn,[F(C,{modelValue:s.value.layerType,"onUpdate:modelValue":c[0]||(c[0]=h=>s.value.layerType=h),onChange:l},{default:Z(()=>[F(p,{value:"t0vec"},{default:Z(()=>c[1]||(c[1]=[ae("街道底图")])),_:1}),F(p,{value:"t3img"},{default:Z(()=>c[2]||(c[2]=[ae("卫星(影像)底图")])),_:1}),F(p,{value:"t4ter"},{default:Z(()=>c[3]||(c[3]=[ae("地形底图")])),_:1})]),_:1},8,["modelValue"])],512),[[J,q(n)]]),P("div",{class:"toggle",title:`点击${q(n)?"隐藏":"显示"}`,onClick:i},null,8,Zn)])}}},jn=me(qn,[["__scopeId","data-v-d79470cc"]]),Nn={class:"dialog_wrap"},Un={key:0},Wn={__name:"SetTokenDialog",setup(e,{expose:t}){const{setMapToken:o}=he();he();let n=_("6b94eac741fe8a50f283b9b11d9d60d2");const s=_(null),i=_(""),l=_([]),u=(v,k)=>{const S=v?l.value.filter(c(v)):l.value;k(S)},c=v=>k=>k.value.toLowerCase().indexOf(v.toLowerCase())===0,p=()=>[{name:"token1",value:"02dd5ea16a6b869b3b37e12f269b1463"},{name:"token2",value:"53ce309465e600f242d351b15013397f"},{name:"token3",value:"37c72a79fe4c6a1b3fa6b1435214b378"},{name:"token4",value:"5a257cd2df1b3311723bd77b0de14baf"},{name:"token5",value:"7786923a385369346d56b966bb6ad62f"}],C=v=>{o(v.value)},h=()=>{if(i.value.length!==32){Ve.warning("请输入正确的token");return}w.emit("initOlMapByToken"),w.emit("resetSwitchLayer"),s.value.hide(),n.value=i.value};return Ge(()=>{l.value=p()}),t({show:v=>{s.value.show(),s.value.setDialogWidth("30%"),i.value=""}}),(v,k)=>{const S=re("el-autocomplete"),m=re("el-button"),d=re("dialog-info");return X(),_t(d,{ref_key:"refDialogInfo",ref:s,class:"dialog_info_wrap",isShowFotter:!0},{DialogTitle:Z(()=>k[1]||(k[1]=[P("span",null,"切换天地图token",-1)])),DialogContainer:Z(()=>[P("div",Nn,[P("p",null,"当前token: "+se(q(n)),1),F(S,{modelValue:i.value,"onUpdate:modelValue":k[0]||(k[0]=f=>i.value=f),style:{width:"65%"},"fetch-suggestions":u,"popper-class":"my-autocomplete",placeholder:"请选择或者输入",onSelect:C,clearable:""},{suffix:Z(()=>k[2]||(k[2]=[])),default:Z(({item:f})=>[P("div",{class:Mt(["input_wrap",{current_selected:f.value===q(n)}])},[P("h3",null,[ae(se(f.name)+" ",1),f.value===q(n)?(X(),Q("span",Un,"- 当前token")):xt("",!0)]),P("span",null,se(f.value),1)],2)]),_:1},8,["modelValue"]),F(m,{type:"primary",style:{"margin-left":"25px"},onClick:h,disabled:i.value===""},{default:Z(()=>k[3]||(k[3]=[ae(" 确定 ")])),_:1},8,["disabled"])])]),_:1},512)}}},Xn=me(Wn,[["__scopeId","data-v-069690c6"]]),Kn={key:0,class:"ol_map_wrap"},Yn={class:"copyright_info"},Hn={key:1},Jn=Ft({name:"gis"}),ao=Object.assign(Jn,{props:{currentPageType:{type:String,default:""},isAutoRenderData:{type:Boolean,default:!1},isShowLend:{type:Boolean,default:!0}},emits:["getOlMapInstance","getCurrentViewData","reflashMap","toggleOverviewInfo","getCircleData","setCircleDialogData"],setup(e,{expose:t,emit:o}){const n=o,s=e,{proxy:i}=$t(),l=Bt(),u="production";let c=null;const p=_(null),C=_(null),h=_(null);_(!0);const D=_(0),v=_(""),k=_(!0);let S=_({});const m={minRenderZoom:we},d=r=>{c=r,n("getOlMapInstance",r,m),pn(r),gn(r,a=>{f(a)},a=>{a(s.currentPageType)})},f=({option:r,feature:a,pixelPoint:y})=>{p.value.hidePopup(),E.setMenuMethods(c,r,a,y,i)},T=r=>{s.isAutoRenderData||n("getCurrentViewData",r),n("getCircleData",r)},B=r=>{fe(r)},j=r=>{un(c,r)},oe=(r,a,y,g=!0)=>{p.value.hidePopup(),k.value&&be(c),setTimeout(()=>{g?a.forEach(L=>{y(r,L)}):y(r,a)},500)},$=async(r,a,y,g)=>{const{arrData:L}=a;y&&y(a),p.value.hidePopup(),r.getView().setZoom(18),_e(c,[a.longitude,a.latitude]),Ce(c),g&&g(r,[a]),setTimeout(()=>{Cn(r,x=>{let b={};switch(x.get("type")){case"Marker":b=x.get("pointData");break;case"Curve":b=x.get("curveData");break}b.cgi===a.cgi&&(S.value={featureData:b,featureItem:x})})},1e3);const M=Se(a.longitude,a.latitude);hn(M,a,x=>{if(L)x.popupData=L,x.noFeature=!0;else{let b=document.querySelector("#popupBack");b&&b.remove()}tt(r,M,L?ue(x):ie(x),b=>{const{target:Y}=b;Y.getAttribute("data-function")==="getMore"&&w.emit("popupDataGetMore",{currentPopupObj:a,callback:Dt=>{w.emit("showPopupDialog",Dt)}}),Y.getAttribute("data-function")==="getSingleByFeatures"&&w.emit("getSingleByFeatures",{unique:Y.getAttribute("data-unique").trim(),itemData:a}),Y.getAttribute("data-function")==="popupBack"&&w.emit("popupBack")})})};w.on("initOlMapByToken",()=>{Me()}),w.on("reflashMap",r=>{r&&c.getView().getZoom()>we&&w.emit("resetBtn"),kn(c),n("reflashMap",r,()=>{Ie(()=>{setTimeout(()=>{if(!At(S.value)){let{featureData:a,featureItem:y}=S.value;Qe(c,y)}},1e3)})})}),w.on("cancelDrawInteraction",()=>{R(c,r=>r.get("drawType")),Te(c)}),w.on("drawPolygon",()=>{Tn(c)}),w.on("cancelPolygon",()=>{Dn(c)}),w.on("drawCircle",()=>{Sn(c)}),w.on("cancelCircle",()=>{}),w.on("testDistance",r=>{bn(c,r)}),w.on("cancelTestDistance",()=>{_n(c)}),w.on("showSetTokenDialog",()=>{var r;(r=h.value)==null||r.show()}),w.on("singleFeaturesClick",({feature:r,pixelPoint:a})=>{if(s.currentPageType==="complain"){n("setCircleDialogData",r);return}ce(c,r,a)});const fe=r=>{r.on("pointermove",a=>{let y=r.getEventPixel(a.originalEvent),g=r.hasFeatureAtPixel(y);r.getTargetElement().style.cursor=g?"pointer":"",v.value=te(a.coordinate)}),r.on("singleclick",a=>{if(ge(r))return;p.value.hidePopup(),Ye();let y=r.getEventPixel(a.originalEvent),g=r.getFeaturesAtPixel(y);const L=b=>g.filter(Y=>Y.get("type")===b),M=b=>JSON.stringify(L(b))!=="[]",x=()=>{let b=L("Marker")[0]||L("Curve")[0];g.length===2?b&&b.get("type")&&ce(c,b,a.coordinate):p.value.setFeaturesPopup(r,a.coordinate,g)};g&&(g.length===1&&(L("Circle").length!==0&&p.value.hidePopup(),ce(r,g[0],a.coordinate)),g.length>1&&(M("Cluster")&&(p.value.hidePopup(),ce(r,g[0],a.coordinate)),(M("Circle")||M("Polygon"))&&x(),M("Circle")||M("Polygon")||(g[0].get("type")==="Curve"||g[0].get("type")==="Marker")&&p.value.setFeaturesPopup(r,a.coordinate,g)))}),r.on("moveend",a=>{let y=c.getView(),g=y.getZoom();D.value=g.toFixed(2);let L=y.getCenter();w.emit("getCurrentCenter",te(L)),w.emit("getCurrentZoom",{zoom:g,minRenderZoom:we}),s.isAutoRenderData&&($e(r),n("getCurrentViewData",r))})},ce=(r,a,y)=>{if(a&&a.get("drawType")&&ge(r))return;let g=null;if(a&&a.get("type")==="Cluster"){p.value.hidePopup();let L=a.get("features");if(L.length===1){g=L[0].get("pointData"),p.value.setCommonPopup(r,y,g,L[0]);return}const M=nn(L.map(x=>x.getGeometry().getCoordinates()));r.getView().fit(M,{duration:1e3,padding:[50,50,50,50]})}a&&a.get("type")==="Marker"&&(g=a.get("pointData"),p.value.setCommonPopup(r,y,g,a)),a&&a.get("type")==="Curve"&&(g=a.get("curveData"),p.value.setCommonPopup(r,y,g)),a&&a.get("type")==="Circle"&&lt(a),a&&a.get("type")==="Polygon"&&(a.get("polygonData"),a.get("businessType"),ct(a))},lt=r=>{let a=r.get("circleData");w.emit("setCircleDialogData",a)},ct=r=>{const{coords:a,lonlat:y,name:g}=r.get("polygonData");w.emit("setPolygonDialogData",{lonlat:y,name:g})},it=r=>dn(r),Se=(r,a)=>yn(r,a),ut=(r,a,y={},g,L)=>{rt(r,a,y,g,L)},dt=(r,a,y,g)=>{at(r,a,y,g)},pt=(r,a)=>{Ln(r,a)},gt=r=>{Ce(r)},yt=(r,a)=>{vn(r,a)},mt=(r,a)=>{nt(r,a)},ft=(r,a,y,g={},L)=>{fn(r,a,y,g,L)},wt=(r,a,y)=>{wn(r,a,y)},be=r=>{$e(r)},ht=(r,a)=>ne(r,a),vt=(r,a,y)=>{y?Ee(r,a,g=>y(g)):Ee(r,a)},_e=(r,a)=>{Pn(r,a)},kt=(r,{coords:a,lonlat:y,polygonData:g},L,M,x)=>{ot(r,{coords:a,lonlat:y,polygonData:g},L,M,x)},Pt=(r,a,y,g,L={},M)=>{et(r,a,y,{businessType:g,...L},M)},Ct=r=>mn(r),Lt=(r,a,y,g)=>{Mn(r,a,y,g)},Me=()=>{{let a=setTimeout(()=>{l.push("/map/openlayer/openlayer-gd"),clearTimeout(a)},5e3)}Tt(c);const r=cn("olMap");d(r),T(r),B(r)},Tt=r=>{r&&ln(r)};return Ge(()=>{Me()}),t({renderFeatureByData:oe,setMapByAutoPopupData:$,getCurrentViewPosition:it,transformToPixelPoint:Se,addCircle:ut,addFlickerPoint:dt,loadKML:pt,removeAllLayer:gt,removeLayerByType:yt,removeLayerByBusinessType:mt,addPoint:ft,setCluster:wt,removeAllDefaultLayer:be,addCurve:vt,createPolygon:kt,flyToCoordinate:_e,setFeaturesStyle:ht,addTextPoint:Pt,getPolygonCenter:Ct,addArrowLine:Lt}),(r,a)=>q(u)==="development"?(X(),Q("section",Kn,[Et(r.$slots,"default"),a[3]||(a[3]=P("section",{id:"olMap",class:"ol_map"},null,-1)),F(Gn,{ref_key:"refLend",ref:C,currentPageType:e.currentPageType,isShowLend:e.isShowLend},null,8,["currentPageType","isShowLend"]),F(jn,{onSwitchBaseLayerType:j}),F(Fn,{ref_key:"refPopupCommon",ref:p,currentPageType:e.currentPageType},null,8,["currentPageType"]),H(P("div",Yn,[a[2]||(a[2]=P("p",null,"Copyright © CMDI.vip All Rights Reserved.",-1)),P("ul",null,[P("li",null,[P("dl",null,[a[0]||(a[0]=P("dt",null,"经纬度：",-1)),P("dd",null,se(v.value),1)])]),P("li",null,[P("dl",null,[a[1]||(a[1]=P("dt",null,"当前层级：",-1)),P("dd",null,se(D.value),1)])])])],512),[[J,!0]]),F(Xn,{ref_key:"refSetTokenDialog",ref:h},null,512)])):(X(),Q("section",Hn," 天地图服务暂不可用,即将跳转高德地图服务页面！ "))}});export{ao as _};
