import{aE as Tt,P as $e,aC as Ve,r as M,O as Oe,o as X,i as H,a4 as se,aD as le,u as q,b as P,e as $,F as _t,g as ne,w as Z,f as oe,T as Ie,c as Mt,t as ae,q as St,Y as xt,D as Bt,aF as At,d as Et,h as zt,aG as Ft}from"./index-AEND5YPl.js";import{g as he,V as $t,f as I,S as G,C as ye,F as U,a as W,W as Vt,X as Ot,M as It,d as Gt,D as J,b as O,c as E,P as Le,e as V,t as pe,h as Rt,i as Zt,j as qt,k as jt,Z as Nt,l as Ut,m as Wt,n as Xt,o as Kt,p as Yt,q as K,r as Ht,T as Ge,L as Jt,K as Qt,s as en,O as Re,I as Ze,u as tn,v as nn}from"./gis-DroEgRhb.js";import{m as w}from"./mittBus-rOgeEvW-.js";import on from"./DemoPopupDetailDialog-BwMyDRA0.js";import{_ as me}from"./plugin-vueexport-helper-DlAUqK2U.js";const qe={commonMenu:{commonMenuMethod1:"拷贝当前经纬度",commonMenuMethod3:"切换天地图token"},commonDynamicMenu:{commonDynamicMenuMethod1:"清除所有要素",commonDynamicMenuMethod2:"显示当前要素信息",commonDynamicMenuMethod3:"仅取消绘制状态",commonDynamicMenuMethod4:"展示分析结果",commonDynamicMenuMethod5:"删除所有绘制内容"},singleMenu:{singleMenuMethod1:"刷新地图",singleMenuMethod2:"清除POI点"}},{commonMenu:xe}=qe;let je=[];for(let e in xe)je.push(xe[e]);const z={menuMethodBtn:qe,commonMenuMethodsArr:je,setMenuMethods(e,t,o,n,s){let i=Q(n);const{commonMenu:l,commonDynamicMenu:u,singleMenu:c}=this.menuMethodBtn;switch(t){case l.commonMenuMethod0:xn(e,o,n);break;case l.commonMenuMethod01:Sn(e,n);break;case"清空自定义标注点":R(e,h=>h.get("tempType")==="myPointByMenu");break;case l.commonMenuMethod02:rt(e,n);break;case"清空自定义闪烁点":document.querySelectorAll(".flicker_point").forEach(h=>{h.classList.remove("flicker_point")});break;case l.commonMenuMethod1:Tt(`[${i}]`,()=>{$e.success(`[${i}] 拷贝成功`)});break;case l.commonMenuMethod2:Qe(e,o);break;case l.commonMenuMethod3:w.emit("showSetTokenDialog");break;case u.commonDynamicMenuMethod1:Ce(e);break;case u.commonDynamicMenuMethod2:w.emit("singleFeaturesClick",{feature:o,pixelPoint:n});break;case u.commonDynamicMenuMethod3:be(e);break;case u.commonDynamicMenuMethod4:let C=o.get("pointData");w.emit("analysisPointData",C);break;case u.commonDynamicMenuMethod5:R(e,h=>h.get("drawType"));break;case c.singleMenuMethod1:w.emit("reflashMap");break;case c.singleMenuMethod2:nt(e,"POIMarker");break}},setMentBtnExtendByPage(e){const{singleMenu:t}=this.menuMethodBtn;switch(e){case"gis":re(t.singleMenuMethod1),re(t.singleMenuMethod2);break}}};let an=0,ve="6b94eac741fe8a50f283b9b11d9d60d2";const Be=he(),B=(e,t=!0)=>(Be.mapToken!==""&&(ve=Be.mapToken),t?e+ve:e),Ne=(e,t={},o={})=>new Vt({source:new Ot({url:e,crossOrigin:"anonymous",...t}),type:"baseLayer",url:e,...o}),Ue=e=>Ne(e,{wrapX:!1},{layerType:"baseMapLayer"}),ke=e=>Ne(e,{},{layerType:"baseMapTxt"}),de={getBaseMapLayer(e){switch(e){case"gd0":return B("https://wprd0{1-4}.is.autonavi.com/appmaptile?&x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=8&ltype=11",!1);case"gd1":return B("https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=128_128&scale=1&style=8&x={x}&y={y}&z={z}",!1);case"gd2":return B("http://webrd02.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",!1);case"gd3":return B("https://webst01.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&style=6",!1);case"gd4":return B("http://webrd01.is.autonavi.com/appmaptile?x=54658&y=26799&z=16&lang=zh_cn&size=1&scale=1&style=8",!1);case"gd5":return B("https://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",!1);case"gd6":return B("http://wprd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}",!1);case"gd7":return B("https://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",!1);case"gd8":return B("https://wprd01.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=2&style=8<ype=11",!1);case"gd9":return B("https://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",!1)}},getBaseMapTxt(e){switch(e){case"gd0":return B("https://wprd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=8&x=54658&y=26799&z=16&scl=1&ltype=4",!1);case"gd1":return B("http://webst01.is.autonavi.com/appmaptile?x=54658&y=26799&z=16&lang=zh_cn&size=1&scale=1&style=8",!1);case"gd2":return B("https://wprd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",!1);case"gd1":return B("https://wprd01.is.",!1);case"gd1":return B("https://wprd01.is.",!1)}}},we=15,Ae={layers:[Ue(de.getBaseMapLayer("gd9")),ke(de.getBaseMapTxt("gd2"))],view:new $t({center:I([121.63,29.88]),zoom:16,maxZoom:17,minZoom:13,constrainResolution:!0,smoothResolutionConstraint:!1})},N=(e,t)=>{e&&(e instanceof Array?(e.length!==0&&re(t),e.length===0&&(z.commonMenuMethodsArr=z.commonMenuMethodsArr.filter(o=>o!==t))):e instanceof V?e.get("tempType")||re(t):(re(t),e.length===0&&(z.commonMenuMethodsArr=z.commonMenuMethodsArr.filter(o=>o!==t)))),!e&&z.commonMenuMethodsArr.includes(t)&&(z.commonMenuMethodsArr=z.commonMenuMethodsArr.filter(o=>o!==t))},We=new G({image:new ye({radius:5,fill:new U({color:"#f49d41"}),stroke:new W({color:"#836365",width:1})})}),Xe=(e,t)=>new G({image:new Ze({src:t,anchor:[.8,80],anchorOrigin:"top-right",anchorXUnits:"fraction",anchorYUnits:"pixels",offsetOrigin:"top-left",size:[100,100],offset:[3,-32],scale:e.getView().getZoom()/30,opacity:.75})}),rn=(e,t,o,n,s)=>{let i=360-n,l=Math.PI*(1/o-1/2);l+=i/180*Math.PI;let u,c,d,C=[];for(let v=0;v<o;++v){let k=v*((360-i)/360);u=l+k*2*Math.PI/o,c=e[0]+t*Math.cos(u),d=e[1]+t*Math.sin(u),C.push([c,d])}C.push(e);let h=new tn(C);h.rotate(s/57.3,e);let D=h.getCoordinates();return new Le([D])},Ke=()=>{document.querySelectorAll(".flicker_point").forEach(t=>{t.classList.remove("flicker_point")})},sn=e=>{e&&(e.getLayers().forEach(function(t){t.setMap(null)}),e.setView(null),e.setTarget(null),e=null)},ln=e=>new It({target:e,layers:Ae.layers,view:Ae.view,interactions:Gt({mouseWheelZoom:!0})}),cn=(e,t)=>{let o="";switch(t){case"empty":o="empty";break;case"t0vec":o="t0cva";break;case"t3img":o="t07cia";break;case"t4ter":o="t4cva";break}let n=Ue(de.getBaseMapLayer(t)),s=ke(de.getBaseMapTxt(o));n.values_.url,s.values_.url;const i=e.getLayers();e.getAllLayers().forEach((l,u)=>{if(l.get("type")==="baseLayer")switch(l.get("layerType")){case"baseMapLayer":e.removeLayer(l),i.insertAt(u,n);break;case"baseMapTxt":if(s!==""&&(e.removeLayer(l),i.insertAt(u,s)),s===""){let c=ke("");e.removeLayer(l),i.insertAt(u,c)}break}})},un=e=>{const t=e.getView().calculateExtent(e.getSize()),o=qt(t),n=jt(t),s=pe(o,"EPSG:3857","EPSG:4326"),i=pe(n,"EPSG:3857","EPSG:4326");return{topLeft:s,bottomRight:i}},pn=e=>{e.getControls().clear(),e.addControl(new Nt),e.addControl(new Ut),e.addControl(new Wt)},re=e=>{z.commonMenuMethodsArr.includes(e)||z.commonMenuMethodsArr.push(e)},Ye=e=>{let t=document.querySelector(".ol_map_wrap"),o=document.querySelector(".menu_wrap");o&&t.removeChild(o),e&&e(t)},dn=(e,t,o)=>{const{commonDynamicMenu:n,singleMenu:s}=z.menuMethodBtn;e.getViewport().addEventListener("contextmenu",i=>{var T;i.preventDefault(),o&&o(m=>{z.setMentBtnExtendByPage(m)});const l=e.getEventCoordinate(i),u=e.getPixelFromCoordinate(l),c=e.forEachFeatureAtPixel(u,m=>m);let d=[],C=[],h=[],D=[];De(e,m=>{let p=m.getSource().getFeatures()[0];p&&(d.push(p),p.get("tempType")==="myPointByMenu"&&C.push(p),p.get("businessType")==="POIMarker"&&h.push(p),p.get("drawType")&&D.push(p))}),N(d,n.commonDynamicMenuMethod1),N(c,n.commonDynamicMenuMethod2);const v=ge(e);N(v,n.commonDynamicMenuMethod3),N(C,"清空自定义标注点");let k=document.querySelectorAll(".flicker_point");N(k,"清空自定义闪烁点"),c&&(T=c.get("pointData"))!=null&&T.isNeedAnalysis&&N(c,n.commonDynamicMenuMethod4),N(D,n.commonDynamicMenuMethod5),N(h,s.singleMenuMethod2),Ye(m=>{let p=null;p=document.createElement("div"),p.setAttribute("class","menu_wrap");let f="";z.commonMenuMethodsArr.forEach(b=>{f+=`<li>${b}</li>`}),p.innerHTML=`
      <ul>
        ${f}
      </ul>
    `,p.style.position="fixed",p.style.left=`${i.clientX}px`,p.style.top=`${i.clientY}px`,m.appendChild(p),p.addEventListener("click",b=>{const A=b.target.textContent;t({option:A,feature:c,pixelPoint:l}),m.removeChild(p)})})})},ge=e=>e.getInteractions().getArray().find(t=>t instanceof J),be=e=>{const t=ge(e);e.removeInteraction(t)},Q=e=>pe(e,"EPSG:3857","EPSG:4326"),gn=(e,t)=>I([e,t]),Pe=e=>Xt(Kt(e)),yn=e=>{const t=e.getGeometry();if(t.getType()==="Polygon"){const o=t.clone();o.transform("EPSG:3857","EPSG:4326");const n=o.getExtent();return Yt(n)}return null},mn=(e,t,o="/",n={},s=1)=>{const i=new E({features:[]}),l=new O({source:i,zIndex:s,style:o==="/"?We:Xe(e,o)});e.addLayer(l);const u=(c,d)=>({geometry:c,type:"Marker",pointData:d,...n});if(t instanceof Array)t.forEach(c=>{const d=new K(I(c.lonlat)),C=new V({...u(d,c.pointData)});i.addFeature(C)});else{const c=new K(I(t.lonlat)),d=new V({...u(c,t.pointData)});i.addFeature(d)}},fn=(e,t,o)=>{let n=new E;if(t instanceof Array)t.forEach(l=>{let u=I([l.longitude,l.latitude]),c=new V({geometry:new K(u),type:"Marker",pointData:l});n.addFeature(c)});else{let l=I([t.longitude,t.latitude]),u=new V({geometry:new K(l),type:"Marker",pointData:t});n.addFeature(u)}let s=new Ht({source:n,distance:50}),i=new O({type:"clusterLayer",source:s,style:function(l){l.set("type","Cluster");let u=l.get("features").length;return u===1?o==="/"?We:Xe(e,o):new G({image:new ye({radius:30,stroke:new W({color:"white"}),fill:new U({color:"blue"})}),text:new Ge({text:u.toString(),fill:new U({color:"white"})})})}});e.addLayer(i)},He=(e,t,o={},n)=>{const s=new V({geometry:new Jt(t),type:"Line",...o});s.setStyle(n);const i=new E({features:[s]}),l=new O({source:i,zIndex:9});e.addLayer(l)},ee=(e,t,o=!1,n=2,s=5)=>new G(o?{image:new ye({radius:s,fill:new U({color:e}),stroke:new W({color:t,width:n})})}:{fill:new U({color:e}),stroke:new W({color:t,width:n})}),Je=()=>ee("rgba(32, 157, 230, 0.2)","rgb(64 158 255)"),Qe=(e,t)=>{let o=null;switch(t.get("type")){case"Marker":o=ee("#409eff","#f00",!0,2,10);break;case"Curve":o=ee("#409eff","#f00",!1,5);break}t.setStyle(o),t.set("temp",!0);let n=new O({source:new E,zIndex:999});R(e,s=>s.get("temp")),n.setOpacity(1),n.getSource().addFeature(t),e.addLayer(n)},et=(e,t,o,n={},s)=>{const i=new G({text:new Ge({text:t,fill:new U({color:"#333333"}),font:"18px pingfang",textAlign:"center",textBaseline:"bottom",padding:[5,10,5,10],offsetX:-20,offsetY:-13,overflow:!0,rotateWithView:!1,rotation:0})});s&&R(e,c=>s(c));const l=new V({geometry:new K(I(o)),type:"textPoint",...n});l.setStyle(i);const u=new O({source:new E({features:[l]}),zIndex:9});e.addLayer(u)},tt=(e,t,o,n,s=null)=>{let i=document.getElementById("popup"),l=document.getElementById("popup-closer");i.style.display="block";let u=new Re({element:i,...s,zIndex:9999});e.addOverlay(u),l.onclick=()=>(u.setPosition(void 0),l.blur(),u=null,!1),u.setPosition(t),u.getElement().onclick=c=>{n(c)}},Ee=(e,t,o)=>{let n=[];t.forEach(l=>{let u=ee("rgba(32, 222, 230, 0.4)","rgba(255, 205, 67, 0.3)"),c=100;if(o){let{myCurveStyle:D,myCurveRadius:v}=o(l);u=D,c=v}let d=I(l.lonlat),C=rn(d,c,100,45,l.curveData.antDirectionAngle),h=new V(C);h.setStyle(u),h.set("type","Curve"),h.set("curveData",l.curveData),n.push(h)});let s=new E;s.addFeatures(n);let i=new O({source:s,zIndex:1});e.addLayer(i)},ze=(e,t,o,n)=>{tt(e,t,o,n,{autoPan:!0})},wn=(e,t,o)=>{const s={name:"通用信息展示弹窗",hdms:Pe(e),coordinate:[t.longitude,t.latitude],popupData:t};o(s)},De=(e,t)=>{let o=e.getLayers().getArray();for(let n=o.length-1;n>=0;--n)o[n]instanceof O&&t(o[n])},Ce=e=>{Ke(),be(e),De(e,t=>{e.removeLayer(t)})},R=(e,t)=>{De(e,o=>{let n=o.getSource().getFeatures()[0];t(n)&&e.removeLayer(o)})},hn=(e,t)=>{R(e,o=>{if(o)return o.get("type")===t})},nt=(e,t)=>{R(e,o=>{if(o)return o.get("businessType")===t})},Fe=e=>{R(e,t=>{if(t)return(t.get("type")==="Marker"||t.get("type")==="Curve"||t.get("type")==="Cluster")&&!t.get("bussinessType")})},vn=e=>{R(e,t=>{if(t)return t.get("tempType")}),Ke()},kn=(e,t)=>{e.getView().animate({center:I(t),duration:800})},Pn=(e,t)=>{e.getLayers().forEach(o=>{let n=null;o&&(n=o.getSource()),n instanceof E&&n.forEachFeature(s=>{t(s)})})},Cn=(e,t)=>{const n=new Qt({extractStyles:!1}).readFeatures(t);n.forEach(i=>{i.getGeometry().transform("EPSG:4326","EPSG:3857")});const s=new E({features:n});e.getView().fit(s.getExtent()),e.getLayers().push(new O({source:s,style:ee("blue","red"),zIndex:100}))},Ln=e=>{e.addInteraction(new J({source:new E,type:"Polygon"})),e.getInteractions().getArray().forEach(t=>{t instanceof J&&t.on("drawend",o=>{const{feature:n}=o,s=n.getGeometry(),i=s.getCoordinates()[0],l=s.transform("EPSG:3857","EPSG:4326").getCoordinates()[0];s instanceof Le&&(ot(e,{coords:i,lonlat:l},{drawType:"polygon"}),e.removeInteraction(t))})})},ot=(e,{coords:t,lonlat:o,polygonData:n},s={},i,l=Je())=>{let u=new V({geometry:new Le([t]),type:"Polygon",...s,polygonData:{coords:t,lonlat:o,...n}});u.setStyle(l);let c=new O({source:new E({features:[u]})});e.addLayer(c),i&&i(u)},bn=e=>{},Dn=e=>{e.addInteraction(new J({source:new E,type:"Circle"})),e.getInteractions().getArray().forEach(t=>{t instanceof J&&t.on("drawend",o=>{const{feature:n}=o,s=n.getGeometry();let l={lonlat:pe(s.getCenter(),"EPSG:3857","EPSG:4326"),radius:s.getRadius()};at(e,l,{drawType:"Circle"}),e.removeInteraction(t)})})},at=(e,t,o={},n,s=!1)=>{t.radius||(t.radius=550);let i=[],l=new V({type:"Circle",...o,circleData:t,geometry:new Rt(I(t.lonlat),t.radius)});l.setStyle(s?new G({fill:new U({color:"rgba(255, 0, 0, 0)"}),stroke:new W({color:"#f00",color:"rgba(255, 0, 0, 0)"})}):Je()),i.push(l);let u=new E;u.addFeatures(i);let c=new O({zIndex:100});if(c.setSource(u),e.addLayer(c),n){let d=0;c.on("postrender",C=>{d>=20&&(d=0);var h=(20-d)*(1/20),D=new G({radius:d,stroke:new W({color:"rgba(255,60,5"+h+")",width:18-d/1.5})});let v=en(C);v.setStyle(D),v.drawGeometry(l.getGeometry()),d=d+.2,e.render()})}},Tn=(e,t)=>{let o=new J({source:new E,type:"LineString"});e.addInteraction(o),o.on("drawend",n=>{const{feature:s}=n,i=s.getGeometry();let l=Zt(i);l=l.toFixed(2);const u=i.getCoordinates(),c=i.transform("EPSG:3857","EPSG:4326").getCoordinates();t&&t(l),He(e,u,{drawType:"TestDistance"}),et(e,l+"米",c[0],{drawType:"TestDistance"})})},_n=e=>{R(e,t=>{t.get("drawType")})},Mn=(e,t,o="../src/components/OpenlayerBaseMap/icon/routearrow.svg",n="arrowLine")=>{function s(i){const l=i.getGeometry(),u=l.getLength();let d=50*e.getView().getResolution(),C=Math.floor(u/d);const h=[new G({stroke:new W({color:"#42b983",width:6})})],D=[],v=[0];l.forEachSegment(function(k,T){let m=T[0]-k[0],p=T[1]-k[1],f=Math.atan2(p,m);v.unshift(Math.sqrt(m**2+p**2)+v[0]),D.push(f)});for(let k=1;k<C;k++){let T=l.getCoordinateAt(k*1/C);const m=k*d,p=v.findIndex(f=>f<=m);h.push(new G({geometry:new K(T),image:new Ze({src:o,opacity:1,anchor:[.5,.5],rotateWithView:!0,rotation:-D[v.length-p-1],scale:.8})}))}return h}He(e,t,{businessType:n},s)},Sn=(e,t)=>{const o=[],n=new V({geometry:new K(t),name:an++,location:t,tempType:"myPointByMenu"}),s=new G({image:new ye({radius:15,fill:new U({color:"#409eff"}),stroke:new W({color:"#4440ff",width:1})})});n.setStyle(s),o.push(n);const i=new E({features:o}),l=new O({source:i,opacity:.8});e.addLayer(l)},rt=(e,t,o="",n)=>{let s=document.createElement("div");s.className=`flicker_point ${o}`;let i=new Re({element:s,position:t,zIndex:0});e.addOverlay(i),n&&s.addEventListener("click",()=>{n()})},xn=(e,t,o)=>{Q(o)},st=()=>document.querySelector("#popup-content"),ie=(e,t)=>{w.emit("setCommonPopupInner",{popupObj:e,featureItem:t,callback:o=>{Ve(o,st())}})},ue=(e,t)=>{let o=[];w.emit("setFeaturesPopupInner",{popupObj:e,callback:n=>{Ve(n,st())},next:n=>{o=n}}),t&&t(o)},Bn={id:"popup",class:"ol-popup popup_toggle"},An={__name:"PopupCommon",props:{currentPageType:{type:String,default:""}},setup(e,{expose:t}){let o=M(!1),n={},s=M(null);const i=e;w.on("showPopupDialog",m=>{u(m,i.currentPageType)}),w.on("getSingleByFeatures",({unique:m,itemData:p})=>{let f=m.split(":");const{arrData:b}=p;n.arrData=b,b.forEach(A=>{A[f[0]]===f[1]&&(n.currentPopupData=A,ie(n),l(n))})}),w.on("popupBack",()=>{n.popupData=n.arrData,n.noFeature=!0,ue(n)});const l=m=>{let p=document.getElementById("popup-content");ie(m);const f=document.createElement("b");f.setAttribute("data-function","popupBack"),f.setAttribute("id","popupBack"),f.setAttribute("title","返回"),f.innerHTML="",p.appendChild(f)},u=(m,p)=>{switch(p){case"demo":Oe(()=>{s.value.show(m)});break}},c=()=>{o.value=!0},d=()=>{o.value=!1},C=(m,p,f,b)=>{let A=document.querySelector("#popupBack");A&&b&&!b.get("businessType")&&A.remove();let j=Q(p);const F={name:"通用信息展示弹窗",hdms:Pe(p),coordinate:j,popupData:f};n=F,w.emit("fixCommonPopupData",F),ze(m,p,ie(F,b),fe=>{D(fe)})},h=(m,p,f)=>{let b=Q(p),A=Pe(p),j=[];f.forEach(F=>{switch(F.get("type")){case"Marker":j.push("标注点");break;case"Curve":j.push("扇区");break}});const te={name:j.length+"个重叠要素",type:Array.from(new Set(j)).join(","),hdms:A,coordinate:b,popupData:f};n=te,ze(m,p,ue(te,F=>{n.currentDataList=F}),F=>{D(F)})},D=async m=>{const{target:p}=m;let f=p.getAttribute("data-function");f==="getMore"&&T(),f==="getSingleByFeatures"&&v(p.getAttribute("data-unique")),f==="popupBack"&&k()},v=m=>{if(!m)return;let p=m.split(":");const f=(b,A)=>{if(!b.get("noPopup")&&b.get(A)[p[0]]===p[1])return n.currentPopupData=b.get(A),b};n.currentPopupFeature=n.popupData.filter(b=>{switch(b.get("type")){case"Marker":return f(b,"pointData");case"Curve":return f(b,"curveData")}}),l(n,n.currentPopupFeature[0])},k=()=>{n.popupData instanceof Array&&ue(n)},T=()=>{w.emit("popupDataGetMore",{currentPopupObj:n,callback:m=>{u(m,i.currentPageType)}})};return t({showPopup:c,hidePopup:d,setCommonPopup:C,setFeaturesPopup:h}),(m,p)=>(X(),H(_t,null,[se(P("div",Bn,p[0]||(p[0]=[P("div",{class:"popup_wrap"},[P("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"}),P("div",{id:"popup-content",class:"popup-content"})],-1)]),512),[[le,q(o)]]),$(on,{ref_key:"refDemoPopupDetailDialog",ref:s},null,512)],64))}},En=me(An,[["__scopeId","data-v-bf6b074e"]]),zn={class:"lend_wrap"},Fn={class:"lent_tb_wrap"},$n=["title"],Vn={__name:"Lend",props:{currentPageType:{type:String,default:""},isShowLend:{type:Boolean,default:!0}},setup(e){w.on("showLend",()=>{t.value=!0});let t=M(!1);const o=()=>{t.value=!t.value};return(n,s)=>se((X(),H("section",zn,[se(P("div",Fn,null,512),[[le,q(t)]]),P("div",{class:"toggle",title:`点击${q(t)?"隐藏":"显示"}图例`,onClick:o},null,8,$n)],512)),[[le,e.isShowLend]])}},On=me(Vn,[["__scopeId","data-v-7149aaf8"]]),In={class:"switch_base_layer_wrap"},Gn={class:"switch_content"},Rn=["title"],Zn={__name:"SwitchBaseLayer",emits:["switchBaseLayerType"],setup(e,{emit:t}){w.on("resetSwitchLayer",()=>{s.value.layerType="t3img"});const o=t;let n=M(!1);const s=M({layerType:"t3img"}),i=()=>{n.value=!n.value},l=u=>{o("switchBaseLayerType",u)};return(u,c)=>{const d=ne("el-radio"),C=ne("el-radio-group");return X(),H("section",In,[se(P("div",Gn,[$(C,{modelValue:s.value.layerType,"onUpdate:modelValue":c[0]||(c[0]=h=>s.value.layerType=h),onChange:l},{default:Z(()=>[$(d,{value:"t0vec"},{default:Z(()=>c[1]||(c[1]=[oe("街道底图")])),_:1}),$(d,{value:"t3img"},{default:Z(()=>c[2]||(c[2]=[oe("卫星(影像)底图")])),_:1}),$(d,{value:"t4ter"},{default:Z(()=>c[3]||(c[3]=[oe("地形底图")])),_:1})]),_:1},8,["modelValue"])],512),[[le,q(n)]]),P("div",{class:"toggle",title:`点击${q(n)?"隐藏":"显示"}`,onClick:i},null,8,Rn)])}}},qn=me(Zn,[["__scopeId","data-v-0273d3a5"]]),jn={class:"dialog_wrap"},Nn={key:0},Un={__name:"SetTokenDialog",setup(e,{expose:t}){const{setMapToken:o}=he();he();let n=M("6b94eac741fe8a50f283b9b11d9d60d2");const s=M(null),i=M(""),l=M([]),u=(v,k)=>{const T=v?l.value.filter(c(v)):l.value;k(T)},c=v=>k=>k.value.toLowerCase().indexOf(v.toLowerCase())===0,d=()=>[{name:"token1",value:"02dd5ea16a6b869b3b37e12f269b1463"},{name:"token2",value:"53ce309465e600f242d351b15013397f"},{name:"token3",value:"37c72a79fe4c6a1b3fa6b1435214b378"},{name:"token4",value:"5a257cd2df1b3311723bd77b0de14baf"},{name:"token5",value:"7786923a385369346d56b966bb6ad62f"}],C=v=>{o(v.value)},h=()=>{if(i.value.length!==32){$e.warning("请输入正确的token");return}w.emit("initOlMapByToken"),w.emit("resetSwitchLayer"),s.value.hide(),n.value=i.value};return Ie(()=>{l.value=d()}),t({show:v=>{s.value.show(),s.value.setDialogWidth("30%"),i.value=""}}),(v,k)=>{const T=ne("el-autocomplete"),m=ne("el-button"),p=ne("dialog-info");return X(),Mt(p,{ref_key:"refDialogInfo",ref:s,class:"dialog_info_wrap",isShowFotter:!0},{DialogTitle:Z(()=>k[1]||(k[1]=[P("span",null,"切换天地图token",-1)])),DialogContainer:Z(()=>[P("div",jn,[P("p",null,"当前token: "+ae(q(n)),1),$(T,{modelValue:i.value,"onUpdate:modelValue":k[0]||(k[0]=f=>i.value=f),style:{width:"65%"},"fetch-suggestions":u,"popper-class":"my-autocomplete",placeholder:"请选择或者输入",onSelect:C,clearable:""},{suffix:Z(()=>k[2]||(k[2]=[])),default:Z(({item:f})=>[P("div",{class:St(["input_wrap",{current_selected:f.value===q(n)}])},[P("h3",null,[oe(ae(f.name)+" ",1),f.value===q(n)?(X(),H("span",Nn,"- 当前token")):xt("",!0)]),P("span",null,ae(f.value),1)],2)]),_:1},8,["modelValue"]),$(m,{type:"primary",style:{"margin-left":"25px"},onClick:h,disabled:i.value===""},{default:Z(()=>k[3]||(k[3]=[oe(" 确定 ")])),_:1},8,["disabled"])])]),_:1},512)}}},Wn=me(Un,[["__scopeId","data-v-e0d3be93"]]),Xn={key:0,class:"ol_map_wrap"},Kn={class:"copyright_info"},Yn={key:1},Hn=zt({name:"gis"}),oo=Object.assign(Hn,{props:{currentPageType:{type:String,default:""},isAutoRenderData:{type:Boolean,default:!1},isShowLend:{type:Boolean,default:!0}},emits:["getOlMapInstance","getCurrentViewData","reflashMap","toggleOverviewInfo","getCircleData","setCircleDialogData"],setup(e,{expose:t,emit:o}){const n=o,s=e,{proxy:i}=Ft(),l=Bt(),u="production";let c=null;const d=M(null),C=M(null),h=M(null);M(!0);const D=M(0),v=M(""),k=M(!0);let T=M({});const m={minRenderZoom:we},p=a=>{c=a,n("getOlMapInstance",a,m),pn(a),dn(a,r=>{f(r)},r=>{r(s.currentPageType)})},f=({option:a,feature:r,pixelPoint:y})=>{d.value.hidePopup(),z.setMenuMethods(c,a,r,y,i)},b=a=>{s.isAutoRenderData||n("getCurrentViewData",a),n("getCircleData",a)},A=a=>{fe(a)},j=a=>{cn(c,a)},te=(a,r,y,g=!0)=>{d.value.hidePopup(),k.value&&_e(c),setTimeout(()=>{g?r.forEach(L=>{y(a,L)}):y(a,r)},500)},F=async(a,r,y,g)=>{const{arrData:L}=r;y&&y(r),d.value.hidePopup(),a.getView().setZoom(18),Me(c,[r.longitude,r.latitude]),Ce(c),g&&g(a,[r]),setTimeout(()=>{Pn(a,x=>{let _={};switch(x.get("type")){case"Marker":_=x.get("pointData");break;case"Curve":_=x.get("curveData");break}_.cgi===r.cgi&&(T.value={featureData:_,featureItem:x})})},1e3);const S=Te(r.longitude,r.latitude);wn(S,r,x=>{if(L)x.popupData=L,x.noFeature=!0;else{let _=document.querySelector("#popupBack");_&&_.remove()}tt(a,S,L?ue(x):ie(x),_=>{const{target:Y}=_;Y.getAttribute("data-function")==="getMore"&&w.emit("popupDataGetMore",{currentPopupObj:r,callback:Dt=>{w.emit("showPopupDialog",Dt)}}),Y.getAttribute("data-function")==="getSingleByFeatures"&&w.emit("getSingleByFeatures",{unique:Y.getAttribute("data-unique").trim(),itemData:r}),Y.getAttribute("data-function")==="popupBack"&&w.emit("popupBack")})})};w.on("initOlMapByToken",()=>{Se()}),w.on("reflashMap",a=>{a&&c.getView().getZoom()>we&&w.emit("resetBtn"),vn(c),n("reflashMap",a,()=>{Oe(()=>{setTimeout(()=>{if(!At(T.value)){let{featureData:r,featureItem:y}=T.value;Qe(c,y)}},1e3)})})}),w.on("cancelDrawInteraction",()=>{R(c,a=>a.get("drawType")),be(c)}),w.on("drawPolygon",()=>{Ln(c)}),w.on("cancelPolygon",()=>{bn(c)}),w.on("drawCircle",()=>{Dn(c)}),w.on("cancelCircle",()=>{}),w.on("testDistance",a=>{Tn(c,a)}),w.on("cancelTestDistance",()=>{_n(c)}),w.on("showSetTokenDialog",()=>{var a;(a=h.value)==null||a.show()}),w.on("singleFeaturesClick",({feature:a,pixelPoint:r})=>{if(s.currentPageType==="complain"){n("setCircleDialogData",a);return}ce(c,a,r)});const fe=a=>{a.on("pointermove",r=>{let y=a.getEventPixel(r.originalEvent),g=a.hasFeatureAtPixel(y);a.getTargetElement().style.cursor=g?"pointer":"",v.value=Q(r.coordinate)}),a.on("singleclick",r=>{if(ge(a))return;d.value.hidePopup(),Ye();let y=a.getEventPixel(r.originalEvent),g=a.getFeaturesAtPixel(y);const L=_=>g.filter(Y=>Y.get("type")===_),S=_=>JSON.stringify(L(_))!=="[]",x=()=>{let _=L("Marker")[0]||L("Curve")[0];g.length===2?_&&_.get("type")&&ce(c,_,r.coordinate):d.value.setFeaturesPopup(a,r.coordinate,g)};g&&(g.length===1&&(L("Circle").length!==0&&d.value.hidePopup(),ce(a,g[0],r.coordinate)),g.length>1&&(S("Cluster")&&(d.value.hidePopup(),ce(a,g[0],r.coordinate)),(S("Circle")||S("Polygon"))&&x(),S("Circle")||S("Polygon")||(g[0].get("type")==="Curve"||g[0].get("type")==="Marker")&&d.value.setFeaturesPopup(a,r.coordinate,g)))}),a.on("moveend",r=>{let y=c.getView(),g=y.getZoom();D.value=g.toFixed(2);let L=y.getCenter();w.emit("getCurrentCenter",Q(L)),w.emit("getCurrentZoom",{zoom:g,minRenderZoom:we}),s.isAutoRenderData&&(Fe(a),n("getCurrentViewData",a))})},ce=(a,r,y)=>{if(r&&r.get("drawType")&&ge(a))return;let g=null;if(r&&r.get("type")==="Cluster"){d.value.hidePopup();let L=r.get("features");if(L.length===1){g=L[0].get("pointData"),d.value.setCommonPopup(a,y,g,L[0]);return}const S=nn(L.map(x=>x.getGeometry().getCoordinates()));a.getView().fit(S,{duration:1e3,padding:[50,50,50,50]})}r&&r.get("type")==="Marker"&&(g=r.get("pointData"),d.value.setCommonPopup(a,y,g,r)),r&&r.get("type")==="Curve"&&(g=r.get("curveData"),d.value.setCommonPopup(a,y,g)),r&&r.get("type")==="Circle"&&lt(r),r&&r.get("type")==="Polygon"&&(r.get("polygonData"),r.get("businessType"),ct(r))},lt=a=>{let r=a.get("circleData");w.emit("setCircleDialogData",r)},ct=a=>{const{coords:r,lonlat:y,name:g}=a.get("polygonData");w.emit("setPolygonDialogData",{lonlat:y,name:g})},it=a=>un(a),Te=(a,r)=>gn(a,r),ut=(a,r,y={},g,L)=>{at(a,r,y,g,L)},pt=(a,r,y,g)=>{rt(a,r,y,g)},dt=(a,r)=>{Cn(a,r)},gt=a=>{Ce(a)},yt=(a,r)=>{hn(a,r)},mt=(a,r)=>{nt(a,r)},ft=(a,r,y,g={},L)=>{mn(a,r,y,g,L)},wt=(a,r,y)=>{fn(a,r,y)},_e=a=>{Fe(a)},ht=(a,r)=>ee(a,r),vt=(a,r,y)=>{y?Ee(a,r,g=>y(g)):Ee(a,r)},Me=(a,r)=>{kn(a,r)},kt=(a,{coords:r,lonlat:y,polygonData:g},L,S,x)=>{ot(a,{coords:r,lonlat:y,polygonData:g},L,S,x)},Pt=(a,r,y,g,L={},S)=>{et(a,r,y,{businessType:g,...L},S)},Ct=a=>yn(a),Lt=(a,r,y,g)=>{Mn(a,r,y,g)},Se=()=>{{let r=setTimeout(()=>{l.push("/map/openlayer/openlayer-gd"),clearTimeout(r)},5e3)}bt(c);const a=ln("olMap");p(a),b(a),A(a)},bt=a=>{a&&sn(a)};return Ie(()=>{Se()}),t({renderFeatureByData:te,setMapByAutoPopupData:F,getCurrentViewPosition:it,transformToPixelPoint:Te,addCircle:ut,addFlickerPoint:pt,loadKML:dt,removeAllLayer:gt,removeLayerByType:yt,removeLayerByBusinessType:mt,addPoint:ft,setCluster:wt,removeAllDefaultLayer:_e,addCurve:vt,createPolygon:kt,flyToCoordinate:Me,setFeaturesStyle:ht,addTextPoint:Pt,getPolygonCenter:Ct,addArrowLine:Lt}),(a,r)=>q(u)==="development"?(X(),H("section",Xn,[Et(a.$slots,"default"),r[3]||(r[3]=P("section",{id:"olMap",class:"ol_map"},null,-1)),$(On,{ref_key:"refLend",ref:C,currentPageType:e.currentPageType,isShowLend:e.isShowLend},null,8,["currentPageType","isShowLend"]),$(qn,{onSwitchBaseLayerType:j}),$(En,{ref_key:"refPopupCommon",ref:d,currentPageType:e.currentPageType},null,8,["currentPageType"]),se(P("div",Kn,[r[2]||(r[2]=P("p",null,"Copyright © CMDI.vip All Rights Reserved.",-1)),P("ul",null,[P("li",null,[P("dl",null,[r[0]||(r[0]=P("dt",null,"经纬度：",-1)),P("dd",null,ae(v.value),1)])]),P("li",null,[P("dl",null,[r[1]||(r[1]=P("dt",null,"当前层级：",-1)),P("dd",null,ae(D.value),1)])])])],512),[[le,!0]]),$(Wn,{ref_key:"refSetTokenDialog",ref:h},null,512)])):(X(),H("section",Yn," 天地图服务暂不可用,即将跳转高德地图服务页面！ "))}});export{oo as _};
