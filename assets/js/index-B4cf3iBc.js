import{aE as St,P as Ve,aC as Oe,r as _,O as Ie,o as X,i as Q,a4 as H,aD as J,u as q,b as P,e as F,F as bt,g as re,w as Z,f as ae,T as Ge,c as _t,t as se,q as Mt,Y as xt,D as Bt,aF as At,d as Et,h as Ft,aG as $t}from"./index-C8JKJPCB.js";import{g as he,V as Vt,f as G,S as z,C as ye,F as U,a as W,W as Ot,X as It,M as Gt,d as zt,D as ee,b as I,c as A,P as Le,e as O,t as de,h as Rt,i as Zt,j as qt,k as jt,Z as Nt,l as Ut,m as Wt,n as Xt,o as Kt,p as Yt,q as K,r as Ht,T as ze,L as Jt,K as Qt,s as eo,O as Re,I as Ze,u as to,v as oo}from"./gis-CMiCktHq.js";import{m as w}from"./mittBus-rOgeEvW-.js";import no from"./DemoPopupDetailDialog-BqK4KcdV.js";import{_ as me}from"./plugin-vueexport-helper-DlAUqK2U.js";import ro from"./index-CQFMNHWM.js";const qe={commonMenu:{commonMenuMethod1:"拷贝当前经纬度",commonMenuMethod3:"切换天地图token"},commonDynamicMenu:{commonDynamicMenuMethod1:"清除所有要素",commonDynamicMenuMethod2:"显示当前要素信息",commonDynamicMenuMethod3:"仅取消绘制状态",commonDynamicMenuMethod4:"展示分析结果",commonDynamicMenuMethod5:"删除所有绘制内容"},singleMenu:{singleMenuMethod1:"刷新地图",singleMenuMethod2:"清除POI点"}},{commonMenu:xe}=qe;let je=[];for(let e in xe)je.push(xe[e]);const E={menuMethodBtn:qe,commonMenuMethodsArr:je,setMenuMethods(e,t,n,o,s){let i=te(o);const{commonMenu:l,commonDynamicMenu:u,singleMenu:c}=this.menuMethodBtn;switch(t){case l.commonMenuMethod0:Bo(e,n,o);break;case l.commonMenuMethod01:xo(e,o);break;case"清空自定义标注点":R(e,h=>h.get("tempType")==="myPointByMenu");break;case l.commonMenuMethod02:at(e,o);break;case"清空自定义闪烁点":document.querySelectorAll(".flicker_point").forEach(h=>{h.classList.remove("flicker_point")});break;case l.commonMenuMethod1:St(`[${i}]`,()=>{Ve.success(`[${i}] 拷贝成功`)});break;case l.commonMenuMethod2:Qe(e,n);break;case l.commonMenuMethod3:w.emit("showSetTokenDialog");break;case u.commonDynamicMenuMethod1:Ce(e);break;case u.commonDynamicMenuMethod2:w.emit("singleFeaturesClick",{feature:n,pixelPoint:o});break;case u.commonDynamicMenuMethod3:Te(e);break;case u.commonDynamicMenuMethod4:let C=n.get("pointData");w.emit("analysisPointData",C);break;case u.commonDynamicMenuMethod5:R(e,h=>h.get("drawType"));break;case c.singleMenuMethod1:w.emit("reflashMap");break;case c.singleMenuMethod2:ot(e,"POIMarker");break}},setMentBtnExtendByPage(e){const{singleMenu:t}=this.menuMethodBtn;switch(e){case"gis":le(t.singleMenuMethod1),le(t.singleMenuMethod2);break}}};let ao=0,ve="6b94eac741fe8a50f283b9b11d9d60d2";const Be=he(),V=(e,t=!0)=>(Be.mapToken!==""&&(ve=Be.mapToken),t?e+ve:e),Ne=(e,t={},n={})=>new Ot({source:new It({url:e,crossOrigin:"anonymous",...t}),type:"baseLayer",url:e,...n}),Ue=e=>Ne(e,{wrapX:!1},{layerType:"baseMapLayer"}),ke=e=>Ne(e,{},{layerType:"baseMapTxt"}),pe={getBaseMapLayer(e){switch(e){case"empty":return V("/xxx/{z}/{y}/{x}.png",!1);case"t0vec":return V("http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=");case"t3img":return V("http://t3.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=");case"t4ter":return V("http://t4.tianditu.com/DataServer?T=ter_w&x={x}&y={y}&l={z}&tk=");case"t07vec":return V("http://t{0-7}.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=");case"t07img":return V("http://t{0-7}.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=")}},getBaseMapTxt(e){switch(e){case"empty":return V("",!1);case"t0cva":return V("http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=");case"t4cva":return V("http://t4.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=");case"t07cia":return V("http://t{0-7}.tianditu.com/DataServer?T=cia_w&x={x}&y={y}&l={z}&tk=");case"t07cva":return V("http://t{0-7}.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=")}}},we=15,Ae={layers:[Ue(pe.getBaseMapLayer("t3img")),ke(pe.getBaseMapTxt("t07cia"))],view:new Vt({center:G([121.63,29.88]),zoom:16,maxZoom:17,minZoom:13,constrainResolution:!0,smoothResolutionConstraint:!1})},N=(e,t)=>{e&&(e instanceof Array?(e.length!==0&&le(t),e.length===0&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(n=>n!==t))):e instanceof O?e.get("tempType")||le(t):(le(t),e.length===0&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(n=>n!==t)))),!e&&E.commonMenuMethodsArr.includes(t)&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(n=>n!==t))},We=new z({image:new ye({radius:5,fill:new U({color:"#f49d41"}),stroke:new W({color:"#836365",width:1})})}),Xe=(e,t)=>new z({image:new Ze({src:t,anchor:[.8,80],anchorOrigin:"top-right",anchorXUnits:"fraction",anchorYUnits:"pixels",offsetOrigin:"top-left",size:[100,100],offset:[3,-32],scale:e.getView().getZoom()/30,opacity:.75})}),so=(e,t,n,o,s)=>{let i=360-o,l=Math.PI*(1/n-1/2);l+=i/180*Math.PI;let u,c,p,C=[];for(let v=0;v<n;++v){let k=v*((360-i)/360);u=l+k*2*Math.PI/n,c=e[0]+t*Math.cos(u),p=e[1]+t*Math.sin(u),C.push([c,p])}C.push(e);let h=new to(C);h.rotate(s/57.3,e);let D=h.getCoordinates();return new Le([D])},Ke=()=>{document.querySelectorAll(".flicker_point").forEach(t=>{t.classList.remove("flicker_point")})},lo=e=>{e&&(e.getLayers().forEach(function(t){t.setMap(null)}),e.setView(null),e.setTarget(null),e=null)},co=e=>new Gt({target:e,layers:Ae.layers,view:Ae.view,interactions:zt({mouseWheelZoom:!0})}),io=(e,t)=>{let n="";switch(t){case"empty":n="empty";break;case"t0vec":n="t0cva";break;case"t3img":n="t07cia";break;case"t4ter":n="t4cva";break}let o=Ue(pe.getBaseMapLayer(t)),s=ke(pe.getBaseMapTxt(n));o.values_.url,s.values_.url;const i=e.getLayers();e.getAllLayers().forEach((l,u)=>{if(l.get("type")==="baseLayer")switch(l.get("layerType")){case"baseMapLayer":e.removeLayer(l),i.insertAt(u,o);break;case"baseMapTxt":if(s!==""&&(e.removeLayer(l),i.insertAt(u,s)),s===""){let c=ke("");e.removeLayer(l),i.insertAt(u,c)}break}})},uo=e=>{const t=e.getView().calculateExtent(e.getSize()),n=qt(t),o=jt(t),s=de(n,"EPSG:3857","EPSG:4326"),i=de(o,"EPSG:3857","EPSG:4326");return{topLeft:s,bottomRight:i}},po=e=>{e.getControls().clear(),e.addControl(new Nt),e.addControl(new Ut),e.addControl(new Wt)},le=e=>{E.commonMenuMethodsArr.includes(e)||E.commonMenuMethodsArr.push(e)},Ye=e=>{let t=document.querySelector(".ol_map_wrap"),n=document.querySelector(".menu_wrap");n&&t.removeChild(n),e&&e(t)},go=(e,t,n)=>{const{commonDynamicMenu:o,singleMenu:s}=E.menuMethodBtn;e.getViewport().addEventListener("contextmenu",i=>{var S;i.preventDefault(),n&&n(m=>{E.setMentBtnExtendByPage(m)});const l=e.getEventCoordinate(i),u=e.getPixelFromCoordinate(l),c=e.forEachFeatureAtPixel(u,m=>m);let p=[],C=[],h=[],D=[];De(e,m=>{let d=m.getSource().getFeatures()[0];d&&(p.push(d),d.get("tempType")==="myPointByMenu"&&C.push(d),d.get("businessType")==="POIMarker"&&h.push(d),d.get("drawType")&&D.push(d))}),N(p,o.commonDynamicMenuMethod1),N(c,o.commonDynamicMenuMethod2);const v=ge(e);N(v,o.commonDynamicMenuMethod3),N(C,"清空自定义标注点");let k=document.querySelectorAll(".flicker_point");N(k,"清空自定义闪烁点"),c&&(S=c.get("pointData"))!=null&&S.isNeedAnalysis&&N(c,o.commonDynamicMenuMethod4),N(D,o.commonDynamicMenuMethod5),N(h,s.singleMenuMethod2),Ye(m=>{let d=null;d=document.createElement("div"),d.setAttribute("class","menu_wrap");let f="";E.commonMenuMethodsArr.forEach(T=>{f+=`<li>${T}</li>`}),d.innerHTML=`
      <ul>
        ${f}
      </ul>
    `,d.style.position="fixed",d.style.left=`${i.clientX}px`,d.style.top=`${i.clientY}px`,m.appendChild(d),d.addEventListener("click",T=>{const B=T.target.textContent;t({option:B,feature:c,pixelPoint:l}),m.removeChild(d)})})})},ge=e=>e.getInteractions().getArray().find(t=>t instanceof ee),Te=e=>{const t=ge(e);e.removeInteraction(t)},te=e=>de(e,"EPSG:3857","EPSG:4326"),yo=(e,t)=>G([e,t]),Pe=e=>Xt(Kt(e)),mo=e=>{const t=e.getGeometry();if(t.getType()==="Polygon"){const n=t.clone();n.transform("EPSG:3857","EPSG:4326");const o=n.getExtent();return Yt(o)}return null},fo=(e,t,n="/",o={},s=1)=>{const i=new A({features:[]}),l=new I({source:i,zIndex:s,style:n==="/"?We:Xe(e,n)});e.addLayer(l);const u=(c,p)=>({geometry:c,type:"Marker",pointData:p,...o});if(t instanceof Array)t.forEach(c=>{const p=new K(G(c.lonlat)),C=new O({...u(p,c.pointData)});i.addFeature(C)});else{const c=new K(G(t.lonlat)),p=new O({...u(c,t.pointData)});i.addFeature(p)}},wo=(e,t,n)=>{let o=new A;if(t instanceof Array)t.forEach(l=>{let u=G([l.longitude,l.latitude]),c=new O({geometry:new K(u),type:"Marker",pointData:l});o.addFeature(c)});else{let l=G([t.longitude,t.latitude]),u=new O({geometry:new K(l),type:"Marker",pointData:t});o.addFeature(u)}let s=new Ht({source:o,distance:50}),i=new I({type:"clusterLayer",source:s,style:function(l){l.set("type","Cluster");let u=l.get("features").length;return u===1?n==="/"?We:Xe(e,n):new z({image:new ye({radius:30,stroke:new W({color:"white"}),fill:new U({color:"blue"})}),text:new ze({text:u.toString(),fill:new U({color:"white"})})})}});e.addLayer(i)},He=(e,t,n={},o)=>{const s=new O({geometry:new Jt(t),type:"Line",...n});s.setStyle(o);const i=new A({features:[s]}),l=new I({source:i,zIndex:9});e.addLayer(l)},oe=(e,t,n=!1,o=2,s=5)=>new z(n?{image:new ye({radius:s,fill:new U({color:e}),stroke:new W({color:t,width:o})})}:{fill:new U({color:e}),stroke:new W({color:t,width:o})}),Je=()=>oe("rgba(32, 157, 230, 0.2)","rgb(64 158 255)"),Qe=(e,t)=>{let n=null;switch(t.get("type")){case"Marker":n=oe("#409eff","#f00",!0,2,10);break;case"Curve":n=oe("#409eff","#f00",!1,5);break}t.setStyle(n),t.set("temp",!0);let o=new I({source:new A,zIndex:999});R(e,s=>s.get("temp")),o.setOpacity(1),o.getSource().addFeature(t),e.addLayer(o)},et=(e,t,n,o={},s)=>{const i=new z({text:new ze({text:t,fill:new U({color:"#333333"}),font:"18px pingfang",textAlign:"center",textBaseline:"bottom",padding:[5,10,5,10],offsetX:-20,offsetY:-13,overflow:!0,rotateWithView:!1,rotation:0})});s&&R(e,c=>s(c));const l=new O({geometry:new K(G(n)),type:"textPoint",...o});l.setStyle(i);const u=new I({source:new A({features:[l]}),zIndex:9});e.addLayer(u)},tt=(e,t,n,o,s=null)=>{let i=document.getElementById("popup"),l=document.getElementById("popup-closer");i.style.display="block";let u=new Re({element:i,...s,zIndex:9999});e.addOverlay(u),l.onclick=()=>(u.setPosition(void 0),l.blur(),u=null,!1),u.setPosition(t),u.getElement().onclick=c=>{o(c)}},Ee=(e,t,n)=>{let o=[];t.forEach(l=>{let u=oe("rgba(32, 222, 230, 0.4)","rgba(255, 205, 67, 0.3)"),c=100;if(n){let{myCurveStyle:D,myCurveRadius:v}=n(l);u=D,c=v}let p=G(l.lonlat),C=so(p,c,100,45,l.curveData.antDirectionAngle),h=new O(C);h.setStyle(u),h.set("type","Curve"),h.set("curveData",l.curveData),o.push(h)});let s=new A;s.addFeatures(o);let i=new I({source:s,zIndex:1});e.addLayer(i)},Fe=(e,t,n,o)=>{tt(e,t,n,o,{autoPan:!0})},ho=(e,t,n)=>{const s={name:"通用信息展示弹窗",hdms:Pe(e),coordinate:[t.longitude,t.latitude],popupData:t};n(s)},De=(e,t)=>{let n=e.getLayers().getArray();for(let o=n.length-1;o>=0;--o)n[o]instanceof I&&t(n[o])},Ce=e=>{Ke(),Te(e),De(e,t=>{e.removeLayer(t)})},R=(e,t)=>{De(e,n=>{let o=n.getSource().getFeatures()[0];t(o)&&e.removeLayer(n)})},vo=(e,t)=>{R(e,n=>{if(n)return n.get("type")===t})},ot=(e,t)=>{R(e,n=>{if(n)return n.get("businessType")===t})},$e=e=>{R(e,t=>{if(t)return(t.get("type")==="Marker"||t.get("type")==="Curve"||t.get("type")==="Cluster")&&!t.get("bussinessType")})},ko=e=>{R(e,t=>{if(t)return t.get("tempType")}),Ke()},Po=(e,t)=>{e.getView().animate({center:G(t),duration:800})},Co=(e,t)=>{e.getLayers().forEach(n=>{let o=null;n&&(o=n.getSource()),o instanceof A&&o.forEachFeature(s=>{t(s)})})},Lo=(e,t)=>{const o=new Qt({extractStyles:!1}).readFeatures(t);o.forEach(i=>{i.getGeometry().transform("EPSG:4326","EPSG:3857")});const s=new A({features:o});e.getView().fit(s.getExtent()),e.getLayers().push(new I({source:s,style:oe("blue","red"),zIndex:100}))},To=e=>{e.addInteraction(new ee({source:new A,type:"Polygon"})),e.getInteractions().getArray().forEach(t=>{t instanceof ee&&t.on("drawend",n=>{const{feature:o}=n,s=o.getGeometry(),i=s.getCoordinates()[0],l=s.transform("EPSG:3857","EPSG:4326").getCoordinates()[0];s instanceof Le&&(nt(e,{coords:i,lonlat:l},{drawType:"polygon"}),e.removeInteraction(t))})})},nt=(e,{coords:t,lonlat:n,polygonData:o},s={},i,l=Je())=>{let u=new O({geometry:new Le([t]),type:"Polygon",...s,polygonData:{coords:t,lonlat:n,...o}});u.setStyle(l);let c=new I({source:new A({features:[u]})});e.addLayer(c),i&&i(u)},Do=e=>{},So=e=>{e.addInteraction(new ee({source:new A,type:"Circle"})),e.getInteractions().getArray().forEach(t=>{t instanceof ee&&t.on("drawend",n=>{const{feature:o}=n,s=o.getGeometry();let l={lonlat:de(s.getCenter(),"EPSG:3857","EPSG:4326"),radius:s.getRadius()};rt(e,l,{drawType:"Circle"}),e.removeInteraction(t)})})},rt=(e,t,n={},o,s=!1)=>{t.radius||(t.radius=550);let i=[],l=new O({type:"Circle",...n,circleData:t,geometry:new Rt(G(t.lonlat),t.radius)});l.setStyle(s?new z({fill:new U({color:"rgba(255, 0, 0, 0)"}),stroke:new W({color:"#f00",color:"rgba(255, 0, 0, 0)"})}):Je()),i.push(l);let u=new A;u.addFeatures(i);let c=new I({zIndex:100});if(c.setSource(u),e.addLayer(c),o){let p=0;c.on("postrender",C=>{p>=20&&(p=0);var h=(20-p)*(1/20),D=new z({radius:p,stroke:new W({color:"rgba(255,60,5"+h+")",width:18-p/1.5})});let v=eo(C);v.setStyle(D),v.drawGeometry(l.getGeometry()),p=p+.2,e.render()})}},bo=(e,t)=>{let n=new ee({source:new A,type:"LineString"});e.addInteraction(n),n.on("drawend",o=>{const{feature:s}=o,i=s.getGeometry();let l=Zt(i);l=l.toFixed(2);const u=i.getCoordinates(),c=i.transform("EPSG:3857","EPSG:4326").getCoordinates();t&&t(l),He(e,u,{drawType:"TestDistance"}),et(e,l+"米",c[0],{drawType:"TestDistance"})})},_o=e=>{R(e,t=>{t.get("drawType")})},Mo=(e,t,n="../src/components/OpenlayerBaseMap/icon/routearrow.svg",o="arrowLine")=>{function s(i){const l=i.getGeometry(),u=l.getLength();let p=50*e.getView().getResolution(),C=Math.floor(u/p);const h=[new z({stroke:new W({color:"#42b983",width:6})})],D=[],v=[0];l.forEachSegment(function(k,S){let m=S[0]-k[0],d=S[1]-k[1],f=Math.atan2(d,m);v.unshift(Math.sqrt(m**2+d**2)+v[0]),D.push(f)});for(let k=1;k<C;k++){let S=l.getCoordinateAt(k*1/C);const m=k*p,d=v.findIndex(f=>f<=m);h.push(new z({geometry:new K(S),image:new Ze({src:n,opacity:1,anchor:[.5,.5],rotateWithView:!0,rotation:-D[v.length-d-1],scale:.8})}))}return h}He(e,t,{businessType:o},s)},xo=(e,t)=>{const n=[],o=new O({geometry:new K(t),name:ao++,location:t,tempType:"myPointByMenu"}),s=new z({image:new ye({radius:15,fill:new U({color:"#409eff"}),stroke:new W({color:"#4440ff",width:1})})});o.setStyle(s),n.push(o);const i=new A({features:n}),l=new I({source:i,opacity:.8});e.addLayer(l)},at=(e,t,n="",o)=>{let s=document.createElement("div");s.className=`flicker_point ${n}`;let i=new Re({element:s,position:t,zIndex:0});e.addOverlay(i),o&&s.addEventListener("click",()=>{o()})},Bo=(e,t,n)=>{te(n)},st=()=>document.querySelector("#popup-content"),ie=(e,t)=>{w.emit("setCommonPopupInner",{popupObj:e,featureItem:t,callback:n=>{Oe(n,st())}})},ue=(e,t)=>{let n=[];w.emit("setFeaturesPopupInner",{popupObj:e,callback:o=>{Oe(o,st())},next:o=>{n=o}}),t&&t(n)},Ao={id:"popup",class:"ol-popup popup_toggle"},Eo={__name:"PopupCommon",props:{currentPageType:{type:String,default:""}},setup(e,{expose:t}){let n=_(!1),o={},s=_(null);const i=e;w.on("showPopupDialog",m=>{u(m,i.currentPageType)}),w.on("getSingleByFeatures",({unique:m,itemData:d})=>{let f=m.split(":");const{arrData:T}=d;o.arrData=T,T.forEach(B=>{B[f[0]]===f[1]&&(o.currentPopupData=B,ie(o),l(o))})}),w.on("popupBack",()=>{o.popupData=o.arrData,o.noFeature=!0,ue(o)});const l=m=>{let d=document.getElementById("popup-content");ie(m);const f=document.createElement("b");f.setAttribute("data-function","popupBack"),f.setAttribute("id","popupBack"),f.setAttribute("title","返回"),f.innerHTML="",d.appendChild(f)},u=(m,d)=>{switch(d){case"demo":Ie(()=>{s.value.show(m)});break}},c=()=>{n.value=!0},p=()=>{n.value=!1},C=(m,d,f,T)=>{let B=document.querySelector("#popupBack");B&&T&&!T.get("businessType")&&B.remove();let j=te(d);const $={name:"通用信息展示弹窗",hdms:Pe(d),coordinate:j,popupData:f};o=$,w.emit("fixCommonPopupData",$),Fe(m,d,ie($,T),fe=>{D(fe)})},h=(m,d,f)=>{let T=te(d),B=Pe(d),j=[];f.forEach($=>{switch($.get("type")){case"Marker":j.push("标注点");break;case"Curve":j.push("扇区");break}});const ne={name:j.length+"个重叠要素",type:Array.from(new Set(j)).join(","),hdms:B,coordinate:T,popupData:f};o=ne,Fe(m,d,ue(ne,$=>{o.currentDataList=$}),$=>{D($)})},D=async m=>{const{target:d}=m;let f=d.getAttribute("data-function");f==="getMore"&&S(),f==="getSingleByFeatures"&&v(d.getAttribute("data-unique")),f==="popupBack"&&k()},v=m=>{if(!m)return;let d=m.split(":");const f=(T,B)=>{if(!T.get("noPopup")&&T.get(B)[d[0]]===d[1])return o.currentPopupData=T.get(B),T};o.currentPopupFeature=o.popupData.filter(T=>{switch(T.get("type")){case"Marker":return f(T,"pointData");case"Curve":return f(T,"curveData")}}),l(o,o.currentPopupFeature[0])},k=()=>{o.popupData instanceof Array&&ue(o)},S=()=>{w.emit("popupDataGetMore",{currentPopupObj:o,callback:m=>{u(m,i.currentPageType)}})};return t({showPopup:c,hidePopup:p,setCommonPopup:C,setFeaturesPopup:h}),(m,d)=>(X(),Q(bt,null,[H(P("div",Ao,d[0]||(d[0]=[P("div",{class:"popup_wrap"},[P("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"}),P("div",{id:"popup-content",class:"popup-content"})],-1)]),512),[[J,q(n)]]),F(no,{ref_key:"refDemoPopupDetailDialog",ref:s},null,512)],64))}},Fo=me(Eo,[["__scopeId","data-v-9b0f878b"]]),$o={class:"lend_wrap"},Vo={class:"lent_tb_wrap"},Oo=["title"],Io={__name:"Lend",props:{currentPageType:{type:String,default:""},isShowLend:{type:Boolean,default:!0}},setup(e){w.on("showLend",()=>{t.value=!0});let t=_(!1);const n=()=>{t.value=!t.value};return(o,s)=>H((X(),Q("section",$o,[H(P("div",Vo,[H(F(ro,null,null,512),[[J,e.currentPageType==="demo"]])],512),[[J,q(t)]]),P("div",{class:"toggle",title:`点击${q(t)?"隐藏":"显示"}图例`,onClick:n},null,8,Oo)],512)),[[J,e.isShowLend]])}},Go=me(Io,[["__scopeId","data-v-ce8fc5de"]]),zo={class:"switch_base_layer_wrap"},Ro={class:"switch_content"},Zo=["title"],qo={__name:"SwitchBaseLayer",emits:["switchBaseLayerType"],setup(e,{emit:t}){w.on("resetSwitchLayer",()=>{s.value.layerType="t3img"});const n=t;let o=_(!1);const s=_({layerType:"t3img"}),i=()=>{o.value=!o.value},l=u=>{n("switchBaseLayerType",u)};return(u,c)=>{const p=re("el-radio"),C=re("el-radio-group");return X(),Q("section",zo,[H(P("div",Ro,[F(C,{modelValue:s.value.layerType,"onUpdate:modelValue":c[0]||(c[0]=h=>s.value.layerType=h),onChange:l},{default:Z(()=>[F(p,{value:"t0vec"},{default:Z(()=>c[1]||(c[1]=[ae("街道底图")])),_:1}),F(p,{value:"t3img"},{default:Z(()=>c[2]||(c[2]=[ae("卫星(影像)底图")])),_:1}),F(p,{value:"t4ter"},{default:Z(()=>c[3]||(c[3]=[ae("地形底图")])),_:1})]),_:1},8,["modelValue"])],512),[[J,q(o)]]),P("div",{class:"toggle",title:`点击${q(o)?"隐藏":"显示"}`,onClick:i},null,8,Zo)])}}},jo=me(qo,[["__scopeId","data-v-d79470cc"]]),No={class:"dialog_wrap"},Uo={key:0},Wo={__name:"SetTokenDialog",setup(e,{expose:t}){const{setMapToken:n}=he();he();let o=_("6b94eac741fe8a50f283b9b11d9d60d2");const s=_(null),i=_(""),l=_([]),u=(v,k)=>{const S=v?l.value.filter(c(v)):l.value;k(S)},c=v=>k=>k.value.toLowerCase().indexOf(v.toLowerCase())===0,p=()=>[{name:"token1",value:"02dd5ea16a6b869b3b37e12f269b1463"},{name:"token2",value:"53ce309465e600f242d351b15013397f"},{name:"token3",value:"37c72a79fe4c6a1b3fa6b1435214b378"},{name:"token4",value:"5a257cd2df1b3311723bd77b0de14baf"},{name:"token5",value:"7786923a385369346d56b966bb6ad62f"}],C=v=>{n(v.value)},h=()=>{if(i.value.length!==32){Ve.warning("请输入正确的token");return}w.emit("initOlMapByToken"),w.emit("resetSwitchLayer"),s.value.hide(),o.value=i.value};return Ge(()=>{l.value=p()}),t({show:v=>{s.value.show(),s.value.setDialogWidth("30%"),i.value=""}}),(v,k)=>{const S=re("el-autocomplete"),m=re("el-button"),d=re("dialog-info");return X(),_t(d,{ref_key:"refDialogInfo",ref:s,class:"dialog_info_wrap",isShowFotter:!0},{DialogTitle:Z(()=>k[1]||(k[1]=[P("span",null,"切换天地图token",-1)])),DialogContainer:Z(()=>[P("div",No,[P("p",null,"当前token: "+se(q(o)),1),F(S,{modelValue:i.value,"onUpdate:modelValue":k[0]||(k[0]=f=>i.value=f),style:{width:"65%"},"fetch-suggestions":u,"popper-class":"my-autocomplete",placeholder:"请选择或者输入",onSelect:C,clearable:""},{suffix:Z(()=>k[2]||(k[2]=[])),default:Z(({item:f})=>[P("div",{class:Mt(["input_wrap",{current_selected:f.value===q(o)}])},[P("h3",null,[ae(se(f.name)+" ",1),f.value===q(o)?(X(),Q("span",Uo,"- 当前token")):xt("",!0)]),P("span",null,se(f.value),1)],2)]),_:1},8,["modelValue"]),F(m,{type:"primary",style:{"margin-left":"25px"},onClick:h,disabled:i.value===""},{default:Z(()=>k[3]||(k[3]=[ae(" 确定 ")])),_:1},8,["disabled"])])]),_:1},512)}}},Xo=me(Wo,[["__scopeId","data-v-069690c6"]]),Ko={key:0,class:"ol_map_wrap"},Yo={class:"copyright_info"},Ho={key:1},Jo=Ft({name:"gis"}),an=Object.assign(Jo,{props:{currentPageType:{type:String,default:""},isAutoRenderData:{type:Boolean,default:!1},isShowLend:{type:Boolean,default:!0}},emits:["getOlMapInstance","getCurrentViewData","reflashMap","toggleOverviewInfo","getCircleData","setCircleDialogData"],setup(e,{expose:t,emit:n}){const o=n,s=e,{proxy:i}=$t(),l=Bt(),u="production";let c=null;const p=_(null),C=_(null),h=_(null);_(!0);const D=_(0),v=_(""),k=_(!0);let S=_({});const m={minRenderZoom:we},d=r=>{c=r,o("getOlMapInstance",r,m),po(r),go(r,a=>{f(a)},a=>{a(s.currentPageType)})},f=({option:r,feature:a,pixelPoint:y})=>{p.value.hidePopup(),E.setMenuMethods(c,r,a,y,i)},T=r=>{s.isAutoRenderData||o("getCurrentViewData",r),o("getCircleData",r)},B=r=>{fe(r)},j=r=>{io(c,r)},ne=(r,a,y,g=!0)=>{p.value.hidePopup(),k.value&&be(c),setTimeout(()=>{g?a.forEach(L=>{y(r,L)}):y(r,a)},500)},$=async(r,a,y,g)=>{const{arrData:L}=a;y&&y(a),p.value.hidePopup(),r.getView().setZoom(18),_e(c,[a.longitude,a.latitude]),Ce(c),g&&g(r,[a]),setTimeout(()=>{Co(r,x=>{let b={};switch(x.get("type")){case"Marker":b=x.get("pointData");break;case"Curve":b=x.get("curveData");break}b.cgi===a.cgi&&(S.value={featureData:b,featureItem:x})})},1e3);const M=Se(a.longitude,a.latitude);ho(M,a,x=>{if(L)x.popupData=L,x.noFeature=!0;else{let b=document.querySelector("#popupBack");b&&b.remove()}tt(r,M,L?ue(x):ie(x),b=>{const{target:Y}=b;Y.getAttribute("data-function")==="getMore"&&w.emit("popupDataGetMore",{currentPopupObj:a,callback:Dt=>{w.emit("showPopupDialog",Dt)}}),Y.getAttribute("data-function")==="getSingleByFeatures"&&w.emit("getSingleByFeatures",{unique:Y.getAttribute("data-unique").trim(),itemData:a}),Y.getAttribute("data-function")==="popupBack"&&w.emit("popupBack")})})};w.on("initOlMapByToken",()=>{Me()}),w.on("reflashMap",r=>{r&&c.getView().getZoom()>we&&w.emit("resetBtn"),ko(c),o("reflashMap",r,()=>{Ie(()=>{setTimeout(()=>{if(!At(S.value)){let{featureData:a,featureItem:y}=S.value;Qe(c,y)}},1e3)})})}),w.on("cancelDrawInteraction",()=>{R(c,r=>r.get("drawType")),Te(c)}),w.on("drawPolygon",()=>{To(c)}),w.on("cancelPolygon",()=>{Do(c)}),w.on("drawCircle",()=>{So(c)}),w.on("cancelCircle",()=>{}),w.on("testDistance",r=>{bo(c,r)}),w.on("cancelTestDistance",()=>{_o(c)}),w.on("showSetTokenDialog",()=>{var r;(r=h.value)==null||r.show()}),w.on("singleFeaturesClick",({feature:r,pixelPoint:a})=>{if(s.currentPageType==="complain"){o("setCircleDialogData",r);return}ce(c,r,a)});const fe=r=>{r.on("pointermove",a=>{let y=r.getEventPixel(a.originalEvent),g=r.hasFeatureAtPixel(y);r.getTargetElement().style.cursor=g?"pointer":"",v.value=te(a.coordinate)}),r.on("singleclick",a=>{if(ge(r))return;p.value.hidePopup(),Ye();let y=r.getEventPixel(a.originalEvent),g=r.getFeaturesAtPixel(y);const L=b=>g.filter(Y=>Y.get("type")===b),M=b=>JSON.stringify(L(b))!=="[]",x=()=>{let b=L("Marker")[0]||L("Curve")[0];g.length===2?b&&b.get("type")&&ce(c,b,a.coordinate):p.value.setFeaturesPopup(r,a.coordinate,g)};g&&(g.length===1&&(L("Circle").length!==0&&p.value.hidePopup(),ce(r,g[0],a.coordinate)),g.length>1&&(M("Cluster")&&(p.value.hidePopup(),ce(r,g[0],a.coordinate)),(M("Circle")||M("Polygon"))&&x(),M("Circle")||M("Polygon")||(g[0].get("type")==="Curve"||g[0].get("type")==="Marker")&&p.value.setFeaturesPopup(r,a.coordinate,g)))}),r.on("moveend",a=>{let y=c.getView(),g=y.getZoom();D.value=g.toFixed(2);let L=y.getCenter();w.emit("getCurrentCenter",te(L)),w.emit("getCurrentZoom",{zoom:g,minRenderZoom:we}),s.isAutoRenderData&&($e(r),o("getCurrentViewData",r))})},ce=(r,a,y)=>{if(a&&a.get("drawType")&&ge(r))return;let g=null;if(a&&a.get("type")==="Cluster"){p.value.hidePopup();let L=a.get("features");if(L.length===1){g=L[0].get("pointData"),p.value.setCommonPopup(r,y,g,L[0]);return}const M=oo(L.map(x=>x.getGeometry().getCoordinates()));r.getView().fit(M,{duration:1e3,padding:[50,50,50,50]})}a&&a.get("type")==="Marker"&&(g=a.get("pointData"),p.value.setCommonPopup(r,y,g,a)),a&&a.get("type")==="Curve"&&(g=a.get("curveData"),p.value.setCommonPopup(r,y,g)),a&&a.get("type")==="Circle"&&lt(a),a&&a.get("type")==="Polygon"&&(a.get("polygonData"),a.get("businessType"),ct(a))},lt=r=>{let a=r.get("circleData");w.emit("setCircleDialogData",a)},ct=r=>{const{coords:a,lonlat:y,name:g}=r.get("polygonData");w.emit("setPolygonDialogData",{lonlat:y,name:g})},it=r=>uo(r),Se=(r,a)=>yo(r,a),ut=(r,a,y={},g,L)=>{rt(r,a,y,g,L)},dt=(r,a,y,g)=>{at(r,a,y,g)},pt=(r,a)=>{Lo(r,a)},gt=r=>{Ce(r)},yt=(r,a)=>{vo(r,a)},mt=(r,a)=>{ot(r,a)},ft=(r,a,y,g={},L)=>{fo(r,a,y,g,L)},wt=(r,a,y)=>{wo(r,a,y)},be=r=>{$e(r)},ht=(r,a)=>oe(r,a),vt=(r,a,y)=>{y?Ee(r,a,g=>y(g)):Ee(r,a)},_e=(r,a)=>{Po(r,a)},kt=(r,{coords:a,lonlat:y,polygonData:g},L,M,x)=>{nt(r,{coords:a,lonlat:y,polygonData:g},L,M,x)},Pt=(r,a,y,g,L={},M)=>{et(r,a,y,{businessType:g,...L},M)},Ct=r=>mo(r),Lt=(r,a,y,g)=>{Mo(r,a,y,g)},Me=()=>{{let a=setTimeout(()=>{l.push("/map/openlayer/openlayer-gd/empty"),clearTimeout(a)},5e3)}Tt(c);const r=co("olMap");d(r),T(r),B(r)},Tt=r=>{r&&lo(r)};return Ge(()=>{Me()}),t({renderFeatureByData:ne,setMapByAutoPopupData:$,getCurrentViewPosition:it,transformToPixelPoint:Se,addCircle:ut,addFlickerPoint:dt,loadKML:pt,removeAllLayer:gt,removeLayerByType:yt,removeLayerByBusinessType:mt,addPoint:ft,setCluster:wt,removeAllDefaultLayer:be,addCurve:vt,createPolygon:kt,flyToCoordinate:_e,setFeaturesStyle:ht,addTextPoint:Pt,getPolygonCenter:Ct,addArrowLine:Lt}),(r,a)=>q(u)==="development"?(X(),Q("section",Ko,[Et(r.$slots,"default"),a[3]||(a[3]=P("section",{id:"olMap",class:"ol_map"},null,-1)),F(Go,{ref_key:"refLend",ref:C,currentPageType:e.currentPageType,isShowLend:e.isShowLend},null,8,["currentPageType","isShowLend"]),F(jo,{onSwitchBaseLayerType:j}),F(Fo,{ref_key:"refPopupCommon",ref:p,currentPageType:e.currentPageType},null,8,["currentPageType"]),H(P("div",Yo,[a[2]||(a[2]=P("p",null,"Copyright © CMDI.vip All Rights Reserved.",-1)),P("ul",null,[P("li",null,[P("dl",null,[a[0]||(a[0]=P("dt",null,"经纬度：",-1)),P("dd",null,se(v.value),1)])]),P("li",null,[P("dl",null,[a[1]||(a[1]=P("dt",null,"当前层级：",-1)),P("dd",null,se(D.value),1)])])])],512),[[J,!0]]),F(Xo,{ref_key:"refSetTokenDialog",ref:h},null,512)])):(X(),Q("section",Ho," 天地图服务暂不可用,即将跳转高德地图服务页面！ "))}});export{an as _};
