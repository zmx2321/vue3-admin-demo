import{ay as St,P as Oe,az as Ie,r as S,O as he,a4 as ce,aA as ie,u as j,o as K,i as Q,b as L,g as re,e as G,w as q,f as ae,T as Ge,c as bt,t as se,q as Mt,Y as _t,D as xt,aB as Bt,d as At,h as Et,aC as Ft}from"./index-C7hs6aog.js";import{g as ve,V as $t,f as z,S as R,C as me,F as W,a as X,W as Vt,X as Ot,M as It,d as Gt,D as ee,b as I,c as A,P as Te,e as O,t as pe,h as zt,i as Rt,j as Zt,k as qt,Z as jt,l as Nt,m as Ut,n as Wt,o as Xt,p as Kt,q as Y,r as Yt,T as ze,L as Ht,K as Jt,s as Qt,O as Re,I as Ze,u as en,v as tn}from"./gis-C0Ezt3Rr.js";import{m as f}from"./mittBus-rOgeEvW-.js";import{_ as fe}from"./plugin-vueexport-helper-DlAUqK2U.js";const qe={commonMenu:{commonMenuMethod1:"拷贝当前经纬度",commonMenuMethod3:"切换天地图token"},commonDynamicMenu:{commonDynamicMenuMethod1:"清除所有要素",commonDynamicMenuMethod2:"显示当前要素信息",commonDynamicMenuMethod3:"仅取消绘制状态",commonDynamicMenuMethod4:"展示分析结果",commonDynamicMenuMethod5:"删除所有绘制内容"},singleMenu:{singleMenuMethod1:"刷新地图",singleMenuMethod2:"清除POI点"}},{commonMenu:Be}=qe;let je=[];for(let e in Be)je.push(Be[e]);const E={menuMethodBtn:qe,commonMenuMethodsArr:je,setMenuMethods(e,t,o,n,s){let i=te(n);const{commonMenu:l,commonDynamicMenu:u,singleMenu:c}=this.menuMethodBtn;switch(t){case l.commonMenuMethod0:Mn(e,o,n);break;case l.commonMenuMethod01:bn(e,n);break;case"清空自定义标注点":Z(e,w=>w.get("tempType")==="myPointByMenu");break;case l.commonMenuMethod02:at(e,n);break;case"清空自定义闪烁点":document.querySelectorAll(".flicker_point").forEach(w=>{w.classList.remove("flicker_point")});break;case l.commonMenuMethod1:St(`[${i}]`,()=>{Oe.success(`[${i}] 拷贝成功`)});break;case l.commonMenuMethod2:Qe(e,o);break;case l.commonMenuMethod3:f.emit("showSetTokenDialog");break;case u.commonDynamicMenuMethod1:Le(e);break;case u.commonDynamicMenuMethod2:f.emit("singleFeaturesClick",{feature:o,pixelPoint:n});break;case u.commonDynamicMenuMethod3:De(e);break;case u.commonDynamicMenuMethod4:let P=o.get("pointData");f.emit("analysisPointData",P);break;case u.commonDynamicMenuMethod5:Z(e,w=>w.get("drawType"));break;case c.singleMenuMethod1:f.emit("reflashMap");break;case c.singleMenuMethod2:nt(e,"POIMarker");break}},setMentBtnExtendByPage(e){const{singleMenu:t}=this.menuMethodBtn;switch(e){case"gis":le(t.singleMenuMethod1),le(t.singleMenuMethod2);break}}};let nn=0,ke="6b94eac741fe8a50f283b9b11d9d60d2";const Ae=ve(),V=(e,t=!0)=>(Ae.mapToken!==""&&(ke=Ae.mapToken),t?e+ke:e),Ne=(e,t={},o={})=>new Vt({source:new Ot({url:e,crossOrigin:"anonymous",...t}),type:"baseLayer",url:e,...o}),Ue=e=>Ne(e,{wrapX:!1},{layerType:"baseMapLayer"}),Pe=e=>Ne(e,{},{layerType:"baseMapTxt"}),ge={getBaseMapLayer(e){switch(e){case"empty":return V("/xxx/{z}/{y}/{x}.png",!1);case"t0vec":return V("http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=");case"t3img":return V("http://t3.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=");case"t4ter":return V("http://t4.tianditu.com/DataServer?T=ter_w&x={x}&y={y}&l={z}&tk=");case"t07vec":return V("http://t{0-7}.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=");case"t07img":return V("http://t{0-7}.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=")}},getBaseMapTxt(e){switch(e){case"empty":return V("",!1);case"t0cva":return V("http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=");case"t4cva":return V("http://t4.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=");case"t07cia":return V("http://t{0-7}.tianditu.com/DataServer?T=cia_w&x={x}&y={y}&l={z}&tk=");case"t07cva":return V("http://t{0-7}.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=")}}},we=15,Ee={layers:[Ue(ge.getBaseMapLayer("t3img")),Pe(ge.getBaseMapTxt("t07cia"))],view:new $t({center:z([121.63,29.88]),zoom:16,maxZoom:17,minZoom:13,constrainResolution:!0,smoothResolutionConstraint:!1})},U=(e,t)=>{e&&(e instanceof Array?(e.length!==0&&le(t),e.length===0&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(o=>o!==t))):e instanceof O?e.get("tempType")||le(t):(le(t),e.length===0&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(o=>o!==t)))),!e&&E.commonMenuMethodsArr.includes(t)&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(o=>o!==t))},We=new R({image:new me({radius:5,fill:new W({color:"#f49d41"}),stroke:new X({color:"#836365",width:1})})}),Xe=(e,t)=>new R({image:new Ze({src:t,anchor:[.8,80],anchorOrigin:"top-right",anchorXUnits:"fraction",anchorYUnits:"pixels",offsetOrigin:"top-left",size:[100,100],offset:[3,-32],scale:e.getView().getZoom()/30,opacity:.75})}),on=(e,t,o,n,s)=>{let i=360-n,l=Math.PI*(1/o-1/2);l+=i/180*Math.PI;let u,c,p,P=[];for(let h=0;h<o;++h){let v=h*((360-i)/360);u=l+v*2*Math.PI/o,c=e[0]+t*Math.cos(u),p=e[1]+t*Math.sin(u),P.push([c,p])}P.push(e);let w=new en(P);w.rotate(s/57.3,e);let b=w.getCoordinates();return new Te([b])},Ke=()=>{document.querySelectorAll(".flicker_point").forEach(t=>{t.classList.remove("flicker_point")})},rn=e=>{e&&(e.getLayers().forEach(function(t){t.setMap(null)}),e.setView(null),e.setTarget(null),e=null)},an=e=>new It({target:e,layers:Ee.layers,view:Ee.view,interactions:Gt({mouseWheelZoom:!0})}),sn=(e,t)=>{let o="";switch(t){case"empty":o="empty";break;case"t0vec":o="t0cva";break;case"t3img":o="t07cia";break;case"t4ter":o="t4cva";break}let n=Ue(ge.getBaseMapLayer(t)),s=Pe(ge.getBaseMapTxt(o));n.values_.url,s.values_.url;const i=e.getLayers();e.getAllLayers().forEach((l,u)=>{if(l.get("type")==="baseLayer")switch(l.get("layerType")){case"baseMapLayer":e.removeLayer(l),i.insertAt(u,n);break;case"baseMapTxt":if(s!==""&&(e.removeLayer(l),i.insertAt(u,s)),s===""){let c=Pe("");e.removeLayer(l),i.insertAt(u,c)}break}})},ln=e=>{const t=e.getView().calculateExtent(e.getSize()),o=Zt(t),n=qt(t),s=pe(o,"EPSG:3857","EPSG:4326"),i=pe(n,"EPSG:3857","EPSG:4326");return{topLeft:s,bottomRight:i}},cn=e=>{e.getControls().clear(),e.addControl(new jt),e.addControl(new Nt),e.addControl(new Ut)},le=e=>{E.commonMenuMethodsArr.includes(e)||E.commonMenuMethodsArr.push(e)},Ye=e=>{let t=document.querySelector(".ol_map_wrap"),o=document.querySelector(".menu_wrap");o&&t.removeChild(o),e&&e(t)},un=(e,t,o)=>{const{commonDynamicMenu:n,singleMenu:s}=E.menuMethodBtn;e.getViewport().addEventListener("contextmenu",i=>{var M;i.preventDefault(),o&&o(D=>{E.setMentBtnExtendByPage(D)});const l=e.getEventCoordinate(i),u=e.getPixelFromCoordinate(l),c=e.forEachFeatureAtPixel(u,D=>D);let p=[],P=[],w=[],b=[];Se(e,D=>{let d=D.getSource().getFeatures()[0];d&&(p.push(d),d.get("tempType")==="myPointByMenu"&&P.push(d),d.get("businessType")==="POIMarker"&&w.push(d),d.get("drawType")&&b.push(d))}),U(p,n.commonDynamicMenuMethod1),U(c,n.commonDynamicMenuMethod2);const h=ye(e);U(h,n.commonDynamicMenuMethod3),U(P,"清空自定义标注点");let v=document.querySelectorAll(".flicker_point");U(v,"清空自定义闪烁点"),c&&(M=c.get("pointData"))!=null&&M.isNeedAnalysis&&U(c,n.commonDynamicMenuMethod4),U(b,n.commonDynamicMenuMethod5),U(w,s.singleMenuMethod2),Ye(D=>{let d=null;d=document.createElement("div"),d.setAttribute("class","menu_wrap");let m="";E.commonMenuMethodsArr.forEach(k=>{m+=`<li>${k}</li>`}),d.innerHTML=`
      <ul>
        ${m}
      </ul>
    `,d.style.position="fixed",d.style.left=`${i.clientX}px`,d.style.top=`${i.clientY}px`,D.appendChild(d),d.addEventListener("click",k=>{const T=k.target.textContent;t({option:T,feature:c,pixelPoint:l}),D.removeChild(d)})})})},ye=e=>e.getInteractions().getArray().find(t=>t instanceof ee),De=e=>{const t=ye(e);e.removeInteraction(t)},te=e=>pe(e,"EPSG:3857","EPSG:4326"),dn=(e,t)=>z([e,t]),Ce=e=>Wt(Xt(e)),pn=e=>{const t=e.getGeometry();if(t.getType()==="Polygon"){const o=t.clone();o.transform("EPSG:3857","EPSG:4326");const n=o.getExtent();return Kt(n)}return null},gn=(e,t,o="/",n={},s=1)=>{const i=new A({features:[]}),l=new I({source:i,zIndex:s,style:o==="/"?We:Xe(e,o)});e.addLayer(l);const u=(c,p)=>({geometry:c,type:"Marker",pointData:p,...n});if(t instanceof Array)t.forEach(c=>{const p=new Y(z(c.lonlat)),P=new O({...u(p,c.pointData)});i.addFeature(P)});else{const c=new Y(z(t.lonlat)),p=new O({...u(c,t.pointData)});i.addFeature(p)}},yn=(e,t,o)=>{let n=new A;if(t instanceof Array)t.forEach(l=>{let u=z([l.longitude,l.latitude]),c=new O({geometry:new Y(u),type:"Marker",pointData:l});n.addFeature(c)});else{let l=z([t.longitude,t.latitude]),u=new O({geometry:new Y(l),type:"Marker",pointData:t});n.addFeature(u)}let s=new Yt({source:n,distance:50}),i=new I({type:"clusterLayer",source:s,style:function(l){l.set("type","Cluster");let u=l.get("features").length;return u===1?o==="/"?We:Xe(e,o):new R({image:new me({radius:30,stroke:new X({color:"white"}),fill:new W({color:"blue"})}),text:new ze({text:u.toString(),fill:new W({color:"white"})})})}});e.addLayer(i)},He=(e,t,o={},n)=>{const s=new O({geometry:new Ht(t),type:"Line",...o});s.setStyle(n);const i=new A({features:[s]}),l=new I({source:i,zIndex:9});e.addLayer(l)},ne=(e,t,o=!1,n=2,s=5)=>new R(o?{image:new me({radius:s,fill:new W({color:e}),stroke:new X({color:t,width:n})})}:{fill:new W({color:e}),stroke:new X({color:t,width:n})}),Je=()=>ne("rgba(32, 157, 230, 0.2)","rgb(64 158 255)"),Qe=(e,t)=>{let o=null;switch(t.get("type")){case"Marker":o=ne("#409eff","#f00",!0,2,10);break;case"Curve":o=ne("#409eff","#f00",!1,5);break}t.setStyle(o),t.set("temp",!0);let n=new I({source:new A,zIndex:999});Z(e,s=>s.get("temp")),n.setOpacity(1),n.getSource().addFeature(t),e.addLayer(n)},et=(e,t,o,n={},s)=>{const i=new R({text:new ze({text:t,fill:new W({color:"#333333"}),font:"18px pingfang",textAlign:"center",textBaseline:"bottom",padding:[5,10,5,10],offsetX:-20,offsetY:-13,overflow:!0,rotateWithView:!1,rotation:0})});s&&Z(e,c=>s(c));const l=new O({geometry:new Y(z(o)),type:"textPoint",...n});l.setStyle(i);const u=new I({source:new A({features:[l]}),zIndex:9});e.addLayer(u)},tt=(e,t,o,n,s=null)=>{let i=document.getElementById("popup"),l=document.getElementById("popup-closer");i.style.display="block";let u=new Re({element:i,...s,zIndex:9999});e.addOverlay(u),l.onclick=()=>(u.setPosition(void 0),l.blur(),u=null,!1),u.setPosition(t),u.getElement().onclick=c=>{n(c)}},Fe=(e,t,o)=>{let n=[];t.forEach(l=>{let u=ne("rgba(32, 222, 230, 0.4)","rgba(255, 205, 67, 0.3)"),c=100;if(o){let{myCurveStyle:b,myCurveRadius:h}=o(l);u=b,c=h}let p=z(l.lonlat),P=on(p,c,100,45,l.curveData.antDirectionAngle),w=new O(P);w.setStyle(u),w.set("type","Curve"),w.set("curveData",l.curveData),n.push(w)});let s=new A;s.addFeatures(n);let i=new I({source:s,zIndex:1});e.addLayer(i)},$e=(e,t,o,n)=>{tt(e,t,o,n,{autoPan:!0})},mn=(e,t,o)=>{const s={name:"通用信息展示弹窗",hdms:Ce(e),coordinate:[t.longitude,t.latitude],popupData:t};o(s)},Se=(e,t)=>{let o=e.getLayers().getArray();for(let n=o.length-1;n>=0;--n)o[n]instanceof I&&t(o[n])},Le=e=>{Ke(),De(e),Se(e,t=>{e.removeLayer(t)})},Z=(e,t)=>{Se(e,o=>{let n=o.getSource().getFeatures()[0];t(n)&&e.removeLayer(o)})},fn=(e,t)=>{Z(e,o=>{if(o)return o.get("type")===t})},nt=(e,t)=>{Z(e,o=>{if(o)return o.get("businessType")===t})},Ve=e=>{Z(e,t=>{if(t)return(t.get("type")==="Marker"||t.get("type")==="Curve"||t.get("type")==="Cluster")&&!t.get("bussinessType")})},wn=e=>{Z(e,t=>{if(t)return t.get("tempType")}),Ke()},hn=(e,t)=>{e.getView().animate({center:z(t),duration:800})},vn=(e,t)=>{e.getLayers().forEach(o=>{let n=null;o&&(n=o.getSource()),n instanceof A&&n.forEachFeature(s=>{t(s)})})},kn=(e,t)=>{const n=new Jt({extractStyles:!1}).readFeatures(t);n.forEach(i=>{i.getGeometry().transform("EPSG:4326","EPSG:3857")});const s=new A({features:n});e.getView().fit(s.getExtent()),e.getLayers().push(new I({source:s,style:ne("blue","red"),zIndex:100}))},Pn=e=>{e.addInteraction(new ee({source:new A,type:"Polygon"})),e.getInteractions().getArray().forEach(t=>{t instanceof ee&&t.on("drawend",o=>{const{feature:n}=o,s=n.getGeometry(),i=s.getCoordinates()[0],l=s.transform("EPSG:3857","EPSG:4326").getCoordinates()[0];s instanceof Te&&(ot(e,{coords:i,lonlat:l},{drawType:"polygon"}),e.removeInteraction(t))})})},ot=(e,{coords:t,lonlat:o,polygonData:n},s={},i,l=Je())=>{let u=new O({geometry:new Te([t]),type:"Polygon",...s,polygonData:{coords:t,lonlat:o,...n}});u.setStyle(l);let c=new I({source:new A({features:[u]})});e.addLayer(c),i&&i(u)},Cn=e=>{},Ln=e=>{e.addInteraction(new ee({source:new A,type:"Circle"})),e.getInteractions().getArray().forEach(t=>{t instanceof ee&&t.on("drawend",o=>{const{feature:n}=o,s=n.getGeometry();let l={lonlat:pe(s.getCenter(),"EPSG:3857","EPSG:4326"),radius:s.getRadius()};rt(e,l,{drawType:"Circle"}),e.removeInteraction(t)})})},rt=(e,t,o={},n,s=!1)=>{t.radius||(t.radius=550);let i=[],l=new O({type:"Circle",...o,circleData:t,geometry:new zt(z(t.lonlat),t.radius)});l.setStyle(s?new R({fill:new W({color:"rgba(255, 0, 0, 0)"}),stroke:new X({color:"#f00",color:"rgba(255, 0, 0, 0)"})}):Je()),i.push(l);let u=new A;u.addFeatures(i);let c=new I({zIndex:100});if(c.setSource(u),e.addLayer(c),n){let p=0;c.on("postrender",P=>{p>=20&&(p=0);var w=(20-p)*(1/20),b=new R({radius:p,stroke:new X({color:"rgba(255,60,5"+w+")",width:18-p/1.5})});let h=Qt(P);h.setStyle(b),h.drawGeometry(l.getGeometry()),p=p+.2,e.render()})}},Tn=(e,t)=>{let o=new ee({source:new A,type:"LineString"});e.addInteraction(o),o.on("drawend",n=>{const{feature:s}=n,i=s.getGeometry();let l=Rt(i);l=l.toFixed(2);const u=i.getCoordinates(),c=i.transform("EPSG:3857","EPSG:4326").getCoordinates();t&&t(l),He(e,u,{drawType:"TestDistance"}),et(e,l+"米",c[0],{drawType:"TestDistance"})})},Dn=e=>{Z(e,t=>{t.get("drawType")})},Sn=(e,t,o="../src/components/OpenlayerBaseMap/icon/routearrow.svg",n="arrowLine")=>{function s(i){const l=i.getGeometry(),u=l.getLength();let p=50*e.getView().getResolution(),P=Math.floor(u/p);const w=[new R({stroke:new X({color:"#42b983",width:6})})],b=[],h=[0];l.forEachSegment(function(v,M){let D=M[0]-v[0],d=M[1]-v[1],m=Math.atan2(d,D);h.unshift(Math.sqrt(D**2+d**2)+h[0]),b.push(m)});for(let v=1;v<P;v++){let M=l.getCoordinateAt(v*1/P);const D=v*p,d=h.findIndex(m=>m<=D);w.push(new R({geometry:new Y(M),image:new Ze({src:o,opacity:1,anchor:[.5,.5],rotateWithView:!0,rotation:-b[h.length-d-1],scale:.8})}))}return w}He(e,t,{businessType:n},s)},bn=(e,t)=>{const o=[],n=new O({geometry:new Y(t),name:nn++,location:t,tempType:"myPointByMenu"}),s=new R({image:new me({radius:15,fill:new W({color:"#409eff"}),stroke:new X({color:"#4440ff",width:1})})});n.setStyle(s),o.push(n);const i=new A({features:o}),l=new I({source:i,opacity:.8});e.addLayer(l)},at=(e,t,o="",n)=>{let s=document.createElement("div");s.className=`flicker_point ${o}`;let i=new Re({element:s,position:t,zIndex:0});e.addOverlay(i),n&&s.addEventListener("click",()=>{n()})},Mn=(e,t,o)=>{te(o)},st=()=>document.querySelector("#popup-content"),ue=(e,t)=>{f.emit("setCommonPopupInner",{popupObj:e,featureItem:t,callback:o=>{Ie(o,st())}})},de=(e,t)=>{let o=[];f.emit("setFeaturesPopupInner",{popupObj:e,callback:n=>{Ie(n,st())},next:n=>{o=n}}),t&&t(o)},_n={id:"popup",class:"ol-popup popup_toggle"},xn={__name:"PopupCommon",props:{currentPageType:{type:String,default:""}},setup(e,{expose:t}){let o=S(!1),n={},s=S(null),i=S(null);const l=e;f.on("showPopupDialog",d=>{c(d,l.currentPageType)}),f.on("getSingleByFeatures",({unique:d,itemData:m})=>{let k=d.split(":");const{arrData:T}=m;n.arrData=T,T.forEach(F=>{F[k[0]]===k[1]&&(n.currentPopupData=F,ue(n),u(n))})}),f.on("popupBack",()=>{n.popupData=n.arrData,n.noFeature=!0,de(n)});const u=d=>{let m=document.getElementById("popup-content");ue(d);const k=document.createElement("b");k.setAttribute("data-function","popupBack"),k.setAttribute("id","popupBack"),k.setAttribute("title","返回"),k.innerHTML="",m.appendChild(k)},c=(d,m)=>{switch(m){case"gis":he(()=>{s.value.show(d)});break;case"complain":he(()=>{i.value.show(d)});break}},p=()=>{o.value=!0},P=()=>{o.value=!1},w=(d,m,k,T)=>{let F=document.querySelector("#popupBack");F&&T&&!T.get("businessType")&&F.remove();let N=te(m);const $={name:"通用信息展示弹窗",hdms:Ce(m),coordinate:N,popupData:k};n=$,f.emit("fixCommonPopupData",$),$e(d,m,ue($,T),H=>{h(H)})},b=(d,m,k)=>{let T=te(m),F=Ce(m),N=[];k.forEach($=>{switch($.get("type")){case"Marker":N.push("标注点");break;case"Curve":N.push("扇区");break}});const oe={name:N.length+"个重叠要素",type:Array.from(new Set(N)).join(","),hdms:F,coordinate:T,popupData:k};n=oe,$e(d,m,de(oe,$=>{n.currentDataList=$}),$=>{h($)})},h=async d=>{const{target:m}=d;let k=m.getAttribute("data-function");k==="getMore"&&D(),k==="getSingleByFeatures"&&v(m.getAttribute("data-unique")),k==="popupBack"&&M()},v=d=>{if(!d)return;let m=d.split(":");const k=(T,F)=>{if(!T.get("noPopup")&&T.get(F)[m[0]]===m[1])return n.currentPopupData=T.get(F),T};n.currentPopupFeature=n.popupData.filter(T=>{switch(T.get("type")){case"Marker":return k(T,"pointData");case"Curve":return k(T,"curveData")}}),u(n,n.currentPopupFeature[0])},M=()=>{n.popupData instanceof Array&&de(n)},D=()=>{f.emit("popupDataGetMore",{currentPopupObj:n,callback:d=>{c(d,l.currentPageType)}})};return t({showPopup:p,hidePopup:P,setCommonPopup:w,setFeaturesPopup:b}),(d,m)=>ce((K(),Q("div",_n,m[0]||(m[0]=[L("div",{class:"popup_wrap"},[L("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"}),L("div",{id:"popup-content",class:"popup-content"})],-1)]),512)),[[ie,j(o)]])}},Bn=fe(xn,[["__scopeId","data-v-268685bc"]]),An={class:"lend_wrap"},En={class:"lent_tb_wrap"},Fn=["title"],$n={__name:"Lend",props:{currentPageType:{type:String,default:""},isShowLend:{type:Boolean,default:!0}},setup(e){f.on("showLend",()=>{t.value=!0});let t=S(!1);const o=()=>{t.value=!t.value};return(n,s)=>ce((K(),Q("section",An,[ce(L("div",En,null,512),[[ie,j(t)]]),L("div",{class:"toggle",title:`点击${j(t)?"隐藏":"显示"}图例`,onClick:o},null,8,Fn)],512)),[[ie,e.isShowLend]])}},Vn=fe($n,[["__scopeId","data-v-4ee77d9d"]]),On={class:"switch_base_layer_wrap"},In={class:"switch_content"},Gn=["title"],zn={__name:"SwitchBaseLayer",emits:["switchBaseLayerType"],setup(e,{emit:t}){f.on("resetSwitchLayer",()=>{s.value.layerType="t3img"});const o=t;let n=S(!1);const s=S({layerType:"t3img"}),i=()=>{n.value=!n.value},l=u=>{o("switchBaseLayerType",u)};return(u,c)=>{const p=re("el-radio"),P=re("el-radio-group");return K(),Q("section",On,[ce(L("div",In,[G(P,{modelValue:s.value.layerType,"onUpdate:modelValue":c[0]||(c[0]=w=>s.value.layerType=w),onChange:l},{default:q(()=>[G(p,{value:"t0vec"},{default:q(()=>c[1]||(c[1]=[ae("街道底图")])),_:1}),G(p,{value:"t3img"},{default:q(()=>c[2]||(c[2]=[ae("卫星(影像)底图")])),_:1}),G(p,{value:"t4ter"},{default:q(()=>c[3]||(c[3]=[ae("地形底图")])),_:1})]),_:1},8,["modelValue"])],512),[[ie,j(n)]]),L("div",{class:"toggle",title:`点击${j(n)?"隐藏":"显示"}`,onClick:i},null,8,Gn)])}}},Rn=fe(zn,[["__scopeId","data-v-d79470cc"]]),Zn={class:"dialog_wrap"},qn={key:0},jn={__name:"SetTokenDialog",setup(e,{expose:t}){const{setMapToken:o}=ve();ve();let n=S("6b94eac741fe8a50f283b9b11d9d60d2");const s=S(null),i=S(""),l=S([]),u=(h,v)=>{const M=h?l.value.filter(c(h)):l.value;v(M)},c=h=>v=>v.value.toLowerCase().indexOf(h.toLowerCase())===0,p=()=>[{name:"token1",value:"02dd5ea16a6b869b3b37e12f269b1463"},{name:"token2",value:"53ce309465e600f242d351b15013397f"},{name:"token3",value:"37c72a79fe4c6a1b3fa6b1435214b378"},{name:"token4",value:"5a257cd2df1b3311723bd77b0de14baf"},{name:"token5",value:"7786923a385369346d56b966bb6ad62f"}],P=h=>{o(h.value)},w=()=>{if(i.value.length!==32){Oe.warning("请输入正确的token");return}f.emit("initOlMapByToken"),f.emit("resetSwitchLayer"),s.value.hide(),n.value=i.value};return Ge(()=>{l.value=p()}),t({show:h=>{s.value.show(),s.value.setDialogWidth("30%"),i.value=""}}),(h,v)=>{const M=re("el-autocomplete"),D=re("el-button"),d=re("dialog-info");return K(),bt(d,{ref_key:"refDialogInfo",ref:s,class:"dialog_info_wrap",isShowFotter:!0},{DialogTitle:q(()=>v[1]||(v[1]=[L("span",null,"切换天地图token",-1)])),DialogContainer:q(()=>[L("div",Zn,[L("p",null,"当前token: "+se(j(n)),1),G(M,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=m=>i.value=m),style:{width:"65%"},"fetch-suggestions":u,"popper-class":"my-autocomplete",placeholder:"请选择或者输入",onSelect:P,clearable:""},{suffix:q(()=>v[2]||(v[2]=[])),default:q(({item:m})=>[L("div",{class:Mt(["input_wrap",{current_selected:m.value===j(n)}])},[L("h3",null,[ae(se(m.name)+" ",1),m.value===j(n)?(K(),Q("span",qn,"- 当前token")):_t("",!0)]),L("span",null,se(m.value),1)],2)]),_:1},8,["modelValue"]),G(D,{type:"primary",style:{"margin-left":"25px"},onClick:w,disabled:i.value===""},{default:q(()=>v[3]||(v[3]=[ae(" 确定 ")])),_:1},8,["disabled"])])]),_:1},512)}}},Nn=fe(jn,[["__scopeId","data-v-069690c6"]]),Un={key:0,class:"ol_map_wrap"},Wn={class:"copyright_info"},Xn={key:1},Kn=Et({name:"gis"}),eo=Object.assign(Kn,{props:{currentPageType:{type:String,default:""},isAutoRenderData:{type:Boolean,default:!1},isShowLend:{type:Boolean,default:!0}},emits:["getOlMapInstance","getCurrentViewData","reflashMap","toggleOverviewInfo","getCircleData","setCircleDialogData"],setup(e,{expose:t,emit:o}){const n=o,s=e,{proxy:i}=Ft(),l=xt(),u="production";let c=null;const p=S(null),P=S(null),w=S(null);S(!0);const b=S(0),h=S(""),v=S(!0);let M=S({});const D={minRenderZoom:we},d=r=>{c=r,n("getOlMapInstance",r,D),cn(r),un(r,a=>{m(a)},a=>{a(s.currentPageType)})},m=({option:r,feature:a,pixelPoint:y})=>{p.value.hidePopup(),E.setMenuMethods(c,r,a,y,i)},k=r=>{s.isAutoRenderData||n("getCurrentViewData",r),n("getCircleData",r)},T=r=>{$(r)},F=r=>{sn(c,r)},N=(r,a,y,g=!0)=>{p.value.hidePopup(),v.value&&Me(c),setTimeout(()=>{g?a.forEach(C=>{y(r,C)}):y(r,a)},500)},oe=async(r,a,y,g)=>{const{arrData:C}=a;y&&y(a),p.value.hidePopup(),r.getView().setZoom(18),_e(c,[a.longitude,a.latitude]),Le(c),g&&g(r,[a]),setTimeout(()=>{vn(r,B=>{let _={};switch(B.get("type")){case"Marker":_=B.get("pointData");break;case"Curve":_=B.get("curveData");break}_.cgi===a.cgi&&(M.value={featureData:_,featureItem:B})})},1e3);const x=be(a.longitude,a.latitude);mn(x,a,B=>{if(C)B.popupData=C,B.noFeature=!0;else{let _=document.querySelector("#popupBack");_&&_.remove()}tt(r,x,C?de(B):ue(B),_=>{const{target:J}=_;J.getAttribute("data-function")==="getMore"&&f.emit("popupDataGetMore",{currentPopupObj:a,callback:Dt=>{f.emit("showPopupDialog",Dt)}}),J.getAttribute("data-function")==="getSingleByFeatures"&&f.emit("getSingleByFeatures",{unique:J.getAttribute("data-unique").trim(),itemData:a}),J.getAttribute("data-function")==="popupBack"&&f.emit("popupBack")})})};f.on("initOlMapByToken",()=>{xe()}),f.on("reflashMap",r=>{r&&c.getView().getZoom()>we&&f.emit("resetBtn"),wn(c),n("reflashMap",r,()=>{he(()=>{setTimeout(()=>{if(!Bt(M.value)){let{featureData:a,featureItem:y}=M.value;Qe(c,y)}},1e3)})})}),f.on("cancelDrawInteraction",()=>{Z(c,r=>r.get("drawType")),De(c)}),f.on("drawPolygon",()=>{Pn(c)}),f.on("cancelPolygon",()=>{Cn(c)}),f.on("drawCircle",()=>{Ln(c)}),f.on("cancelCircle",()=>{}),f.on("testDistance",r=>{Tn(c,r)}),f.on("cancelTestDistance",()=>{Dn(c)}),f.on("showSetTokenDialog",()=>{var r;(r=w.value)==null||r.show()}),f.on("singleFeaturesClick",({feature:r,pixelPoint:a})=>{if(s.currentPageType==="complain"){n("setCircleDialogData",r);return}H(c,r,a)});const $=r=>{r.on("pointermove",a=>{let y=r.getEventPixel(a.originalEvent),g=r.hasFeatureAtPixel(y);r.getTargetElement().style.cursor=g?"pointer":"",h.value=te(a.coordinate)}),r.on("singleclick",a=>{if(ye(r))return;p.value.hidePopup(),Ye();let y=r.getEventPixel(a.originalEvent),g=r.getFeaturesAtPixel(y);const C=_=>g.filter(J=>J.get("type")===_),x=_=>JSON.stringify(C(_))!=="[]",B=()=>{let _=C("Marker")[0]||C("Curve")[0];g.length===2?_&&_.get("type")&&H(c,_,a.coordinate):p.value.setFeaturesPopup(r,a.coordinate,g)};g&&(g.length===1&&(C("Circle").length!==0&&p.value.hidePopup(),H(r,g[0],a.coordinate)),g.length>1&&(x("Cluster")&&(p.value.hidePopup(),H(r,g[0],a.coordinate)),(x("Circle")||x("Polygon"))&&B(),x("Circle")||x("Polygon")||(g[0].get("type")==="Curve"||g[0].get("type")==="Marker")&&p.value.setFeaturesPopup(r,a.coordinate,g)))}),r.on("moveend",a=>{let y=c.getView(),g=y.getZoom();b.value=g.toFixed(2);let C=y.getCenter();f.emit("getCurrentCenter",te(C)),f.emit("getCurrentZoom",{zoom:g,minRenderZoom:we}),s.isAutoRenderData&&(Ve(r),n("getCurrentViewData",r))})},H=(r,a,y)=>{if(a&&a.get("drawType")&&ye(r))return;let g=null;if(a&&a.get("type")==="Cluster"){p.value.hidePopup();let C=a.get("features");if(C.length===1){g=C[0].get("pointData"),p.value.setCommonPopup(r,y,g,C[0]);return}const x=tn(C.map(B=>B.getGeometry().getCoordinates()));r.getView().fit(x,{duration:1e3,padding:[50,50,50,50]})}a&&a.get("type")==="Marker"&&(g=a.get("pointData"),p.value.setCommonPopup(r,y,g,a)),a&&a.get("type")==="Curve"&&(g=a.get("curveData"),p.value.setCommonPopup(r,y,g)),a&&a.get("type")==="Circle"&&lt(a),a&&a.get("type")==="Polygon"&&(a.get("polygonData"),a.get("businessType"),ct(a))},lt=r=>{let a=r.get("circleData");f.emit("setCircleDialogData",a)},ct=r=>{const{coords:a,lonlat:y,name:g}=r.get("polygonData");f.emit("setPolygonDialogData",{lonlat:y,name:g})},it=r=>ln(r),be=(r,a)=>dn(r,a),ut=(r,a,y={},g,C)=>{rt(r,a,y,g,C)},dt=(r,a,y,g)=>{at(r,a,y,g)},pt=(r,a)=>{kn(r,a)},gt=r=>{Le(r)},yt=(r,a)=>{fn(r,a)},mt=(r,a)=>{nt(r,a)},ft=(r,a,y,g={},C)=>{gn(r,a,y,g,C)},wt=(r,a,y)=>{yn(r,a,y)},Me=r=>{Ve(r)},ht=(r,a)=>ne(r,a),vt=(r,a,y)=>{y?Fe(r,a,g=>y(g)):Fe(r,a)},_e=(r,a)=>{hn(r,a)},kt=(r,{coords:a,lonlat:y,polygonData:g},C,x,B)=>{ot(r,{coords:a,lonlat:y,polygonData:g},C,x,B)},Pt=(r,a,y,g,C={},x)=>{et(r,a,y,{businessType:g,...C},x)},Ct=r=>pn(r),Lt=(r,a,y,g)=>{Sn(r,a,y,g)},xe=()=>{{let a=setTimeout(()=>{l.push("/map/openlayer/openlayer-gd"),clearTimeout(a)},5e3)}Tt(c);const r=an("olMap");d(r),k(r),T(r)},Tt=r=>{r&&rn(r)};return Ge(()=>{xe()}),t({renderFeatureByData:N,setMapByAutoPopupData:oe,getCurrentViewPosition:it,transformToPixelPoint:be,addCircle:ut,addFlickerPoint:dt,loadKML:pt,removeAllLayer:gt,removeLayerByType:yt,removeLayerByBusinessType:mt,addPoint:ft,setCluster:wt,removeAllDefaultLayer:Me,addCurve:vt,createPolygon:kt,flyToCoordinate:_e,setFeaturesStyle:ht,addTextPoint:Pt,getPolygonCenter:Ct,addArrowLine:Lt}),(r,a)=>j(u)==="development"?(K(),Q("section",Un,[At(r.$slots,"default"),a[3]||(a[3]=L("section",{id:"olMap",class:"ol_map"},null,-1)),G(Vn,{ref_key:"refLend",ref:P,currentPageType:e.currentPageType,isShowLend:e.isShowLend},null,8,["currentPageType","isShowLend"]),G(Rn,{onSwitchBaseLayerType:F}),G(Bn,{ref_key:"refPopupCommon",ref:p,currentPageType:e.currentPageType},null,8,["currentPageType"]),ce(L("div",Wn,[a[2]||(a[2]=L("p",null,"Copyright © CMDI.vip All Rights Reserved.",-1)),L("ul",null,[L("li",null,[L("dl",null,[a[0]||(a[0]=L("dt",null,"经纬度：",-1)),L("dd",null,se(h.value),1)])]),L("li",null,[L("dl",null,[a[1]||(a[1]=L("dt",null,"当前层级：",-1)),L("dd",null,se(b.value),1)])])])],512),[[ie,!0]]),G(Nn,{ref_key:"refSetTokenDialog",ref:w},null,512)])):(K(),Q("section",Xn," 天地图服务暂不可用,即将跳转高德地图服务页面！ "))}});export{eo as _};
