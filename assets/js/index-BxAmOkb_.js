import{ay as _t,P as Oe,az as Ve,r as M,O as he,a4 as se,aA as le,u as W,o as Y,i as ce,b as L,g as ne,e as I,w as q,f as oe,T as Ie,c as Ge,t as ae,q as Mt,Y as Tt,aB as Dt,d as St,h as xt,aC as Bt}from"./index-Cnw_w6NK.js";import{g as ve,V as At,f as G,S as R,C as ye,F as X,a as K,W as Et,X as zt,M as Ft,d as $t,D as Q,b as V,c as E,P as be,e as O,t as pe,h as Ot,i as Vt,j as It,k as Gt,Z as Rt,l as Zt,m as qt,n as jt,o as Nt,p as Ut,q as H,r as Wt,T as Re,L as Xt,K as Kt,s as Yt,O as Ze,I as qe,u as Ht,v as Jt}from"./gis-CHAcCdh6.js";import{m as f}from"./mittBus-rOgeEvW-.js";import{_ as me}from"./plugin-vueexport-helper-DlAUqK2U.js";const je={commonMenu:{commonMenuMethod1:"拷贝当前经纬度",commonMenuMethod3:"切换天地图token"},commonDynamicMenu:{commonDynamicMenuMethod1:"清除所有要素",commonDynamicMenuMethod2:"显示当前要素信息",commonDynamicMenuMethod3:"仅取消绘制状态",commonDynamicMenuMethod4:"展示分析结果",commonDynamicMenuMethod5:"删除所有绘制内容"},singleMenu:{singleMenuMethod1:"刷新地图",singleMenuMethod2:"清除POI点"}},{commonMenu:Be}=je;let Ne=[];for(let e in Be)Ne.push(Be[e]);const z={menuMethodBtn:je,commonMenuMethodsArr:Ne,setMenuMethods(e,t,o,n,l){let i=ee(n);const{commonMenu:s,commonDynamicMenu:c,singleMenu:u}=this.menuMethodBtn;switch(t){case s.commonMenuMethod0:_n(e,o,n);break;case s.commonMenuMethod01:bn(e,n);break;case"清空自定义标注点":Z(e,h=>h.get("tempType")==="myPointByMenu");break;case s.commonMenuMethod02:st(e,n);break;case"清空自定义闪烁点":document.querySelectorAll(".flicker_point").forEach(h=>{h.classList.remove("flicker_point")});break;case s.commonMenuMethod1:_t(`[${i}]`,()=>{Oe.success(`[${i}] 拷贝成功`)});break;case s.commonMenuMethod2:et(e,o);break;case s.commonMenuMethod3:f.emit("showSetTokenDialog");break;case c.commonDynamicMenuMethod1:Le(e);break;case c.commonDynamicMenuMethod2:f.emit("singleFeaturesClick",{feature:o,pixelPoint:n});break;case c.commonDynamicMenuMethod3:_e(e);break;case c.commonDynamicMenuMethod4:let P=o.get("pointData");f.emit("analysisPointData",P);break;case c.commonDynamicMenuMethod5:Z(e,h=>h.get("drawType"));break;case u.singleMenuMethod1:f.emit("reflashMap");break;case u.singleMenuMethod2:ot(e,"POIMarker");break}},setMentBtnExtendByPage(e){const{singleMenu:t}=this.menuMethodBtn;switch(e){case"gis":re(t.singleMenuMethod1),re(t.singleMenuMethod2);break}}};let Qt=0,Pe="6b94eac741fe8a50f283b9b11d9d60d2";const Ae=ve(),A=(e,t=!0)=>(Ae.mapToken!==""&&(Pe=Ae.mapToken),t?e+Pe:e),Ue=(e,t={},o={})=>new Et({source:new zt({url:e,crossOrigin:"anonymous",...t}),type:"baseLayer",url:e,...o}),We=e=>Ue(e,{wrapX:!1},{layerType:"baseMapLayer"}),Ce=e=>Ue(e,{},{layerType:"baseMapTxt"}),de={getBaseMapLayer(e){switch(e){case"gd0":return A("https://wprd0{1-4}.is.autonavi.com/appmaptile?&x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=8&ltype=11",!1);case"gd1":return A("https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=128_128&scale=1&style=8&x={x}&y={y}&z={z}",!1);case"gd2":return A("http://webrd02.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",!1);case"gd3":return A("https://webst01.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&style=6",!1);case"gd4":return A("http://webrd01.is.autonavi.com/appmaptile?x=54658&y=26799&z=16&lang=zh_cn&size=1&scale=1&style=8",!1);case"gd5":return A("https://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",!1);case"gd6":return A("http://wprd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}",!1);case"gd7":return A("https://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",!1);case"gd8":return A("https://wprd01.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=2&style=8<ype=11",!1);case"gd9":return A("https://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",!1)}},getBaseMapTxt(e){switch(e){case"gd0":return A("https://wprd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=8&x=54658&y=26799&z=16&scl=1&ltype=4",!1);case"gd1":return A("http://webst01.is.autonavi.com/appmaptile?x=54658&y=26799&z=16&lang=zh_cn&size=1&scale=1&style=8",!1);case"gd2":return A("https://wprd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",!1);case"gd1":return A("https://wprd01.is.",!1);case"gd1":return A("https://wprd01.is.",!1)}}},we=15,Ee={layers:[We(de.getBaseMapLayer("gd9")),Ce(de.getBaseMapTxt("gd2"))],view:new At({center:G([121.63,29.88]),zoom:16,maxZoom:17,minZoom:13,constrainResolution:!0,smoothResolutionConstraint:!1})},U=(e,t)=>{e&&(e instanceof Array?(e.length!==0&&re(t),e.length===0&&(z.commonMenuMethodsArr=z.commonMenuMethodsArr.filter(o=>o!==t))):e instanceof O?e.get("tempType")||re(t):(re(t),e.length===0&&(z.commonMenuMethodsArr=z.commonMenuMethodsArr.filter(o=>o!==t)))),!e&&z.commonMenuMethodsArr.includes(t)&&(z.commonMenuMethodsArr=z.commonMenuMethodsArr.filter(o=>o!==t))},Xe=new R({image:new ye({radius:5,fill:new X({color:"#f49d41"}),stroke:new K({color:"#836365",width:1})})}),Ke=(e,t)=>new R({image:new qe({src:t,anchor:[.8,80],anchorOrigin:"top-right",anchorXUnits:"fraction",anchorYUnits:"pixels",offsetOrigin:"top-left",size:[100,100],offset:[3,-32],scale:e.getView().getZoom()/30,opacity:.75})}),en=(e,t,o,n,l)=>{let i=360-n,s=Math.PI*(1/o-1/2);s+=i/180*Math.PI;let c,u,m,P=[];for(let w=0;w<o;++w){let v=w*((360-i)/360);c=s+v*2*Math.PI/o,u=e[0]+t*Math.cos(c),m=e[1]+t*Math.sin(c),P.push([u,m])}P.push(e);let h=new Ht(P);h.rotate(l/57.3,e);let D=h.getCoordinates();return new be([D])},Ye=()=>{document.querySelectorAll(".flicker_point").forEach(t=>{t.classList.remove("flicker_point")})},tn=e=>{e&&(e.getLayers().forEach(function(t){t.setMap(null)}),e.setView(null),e.setTarget(null),e=null)},nn=e=>new Ft({target:e,layers:Ee.layers,view:Ee.view,interactions:$t({mouseWheelZoom:!0})}),on=(e,t)=>{let o="";switch(t){case"empty":o="empty";break;case"t0vec":o="t0cva";break;case"t3img":o="t07cia";break;case"t4ter":o="t4cva";break}let n=We(de.getBaseMapLayer(t)),l=Ce(de.getBaseMapTxt(o));n.values_.url,l.values_.url;const i=e.getLayers();e.getAllLayers().forEach((s,c)=>{if(s.get("type")==="baseLayer")switch(s.get("layerType")){case"baseMapLayer":e.removeLayer(s),i.insertAt(c,n);break;case"baseMapTxt":if(l!==""&&(e.removeLayer(s),i.insertAt(c,l)),l===""){let u=Ce("");e.removeLayer(s),i.insertAt(c,u)}break}})},an=e=>{const t=e.getView().calculateExtent(e.getSize()),o=It(t),n=Gt(t),l=pe(o,"EPSG:3857","EPSG:4326"),i=pe(n,"EPSG:3857","EPSG:4326");return{topLeft:l,bottomRight:i}},rn=e=>{e.getControls().clear(),e.addControl(new Rt),e.addControl(new Zt),e.addControl(new qt)},re=e=>{z.commonMenuMethodsArr.includes(e)||z.commonMenuMethodsArr.push(e)},He=e=>{let t=document.querySelector(".ol_map_wrap"),o=document.querySelector(".menu_wrap");o&&t.removeChild(o),e&&e(t)},sn=(e,t,o)=>{const{commonDynamicMenu:n,singleMenu:l}=z.menuMethodBtn;e.getViewport().addEventListener("contextmenu",i=>{var S;i.preventDefault(),o&&o(_=>{z.setMentBtnExtendByPage(_)});const s=e.getEventCoordinate(i),c=e.getPixelFromCoordinate(s),u=e.forEachFeatureAtPixel(c,_=>_);let m=[],P=[],h=[],D=[];Me(e,_=>{let p=_.getSource().getFeatures()[0];p&&(m.push(p),p.get("tempType")==="myPointByMenu"&&P.push(p),p.get("businessType")==="POIMarker"&&h.push(p),p.get("drawType")&&D.push(p))}),U(m,n.commonDynamicMenuMethod1),U(u,n.commonDynamicMenuMethod2);const w=ge(e);U(w,n.commonDynamicMenuMethod3),U(P,"清空自定义标注点");let v=document.querySelectorAll(".flicker_point");U(v,"清空自定义闪烁点"),u&&(S=u.get("pointData"))!=null&&S.isNeedAnalysis&&U(u,n.commonDynamicMenuMethod4),U(D,n.commonDynamicMenuMethod5),U(h,l.singleMenuMethod2),He(_=>{let p=null;p=document.createElement("div"),p.setAttribute("class","menu_wrap");let y="";z.commonMenuMethodsArr.forEach(C=>{y+=`<li>${C}</li>`}),p.innerHTML=`
      <ul>
        ${y}
      </ul>
    `,p.style.position="fixed",p.style.left=`${i.clientX}px`,p.style.top=`${i.clientY}px`,_.appendChild(p),p.addEventListener("click",C=>{const b=C.target.textContent;t({option:b,feature:u,pixelPoint:s}),_.removeChild(p)})})})},ge=e=>e.getInteractions().getArray().find(t=>t instanceof Q),_e=e=>{const t=ge(e);e.removeInteraction(t)},ee=e=>pe(e,"EPSG:3857","EPSG:4326"),ln=(e,t)=>G([e,t]),ke=e=>jt(Nt(e)),cn=e=>{const t=e.getGeometry();if(t.getType()==="Polygon"){const o=t.clone();o.transform("EPSG:3857","EPSG:4326");const n=o.getExtent();return Ut(n)}return null},un=(e,t,o="/",n={},l=1)=>{const i=new E({features:[]}),s=new V({source:i,zIndex:l,style:o==="/"?Xe:Ke(e,o)});e.addLayer(s);const c=(u,m)=>({geometry:u,type:"Marker",pointData:m,...n});if(t instanceof Array)t.forEach(u=>{const m=new H(G(u.lonlat)),P=new O({...c(m,u.pointData)});i.addFeature(P)});else{const u=new H(G(t.lonlat)),m=new O({...c(u,t.pointData)});i.addFeature(m)}},pn=(e,t,o)=>{let n=new E;if(t instanceof Array)t.forEach(s=>{let c=G([s.longitude,s.latitude]),u=new O({geometry:new H(c),type:"Marker",pointData:s});n.addFeature(u)});else{let s=G([t.longitude,t.latitude]),c=new O({geometry:new H(s),type:"Marker",pointData:t});n.addFeature(c)}let l=new Wt({source:n,distance:50}),i=new V({type:"clusterLayer",source:l,style:function(s){s.set("type","Cluster");let c=s.get("features").length;return c===1?o==="/"?Xe:Ke(e,o):new R({image:new ye({radius:30,stroke:new K({color:"white"}),fill:new X({color:"blue"})}),text:new Re({text:c.toString(),fill:new X({color:"white"})})})}});e.addLayer(i)},Je=(e,t,o={},n)=>{const l=new O({geometry:new Xt(t),type:"Line",...o});l.setStyle(n);const i=new E({features:[l]}),s=new V({source:i,zIndex:9});e.addLayer(s)},te=(e,t,o=!1,n=2,l=5)=>new R(o?{image:new ye({radius:l,fill:new X({color:e}),stroke:new K({color:t,width:n})})}:{fill:new X({color:e}),stroke:new K({color:t,width:n})}),Qe=()=>te("rgba(32, 157, 230, 0.2)","rgb(64 158 255)"),et=(e,t)=>{let o=null;switch(t.get("type")){case"Marker":o=te("#409eff","#f00",!0,2,10);break;case"Curve":o=te("#409eff","#f00",!1,5);break}t.setStyle(o),t.set("temp",!0);let n=new V({source:new E,zIndex:999});Z(e,l=>l.get("temp")),n.setOpacity(1),n.getSource().addFeature(t),e.addLayer(n)},tt=(e,t,o,n={},l)=>{const i=new R({text:new Re({text:t,fill:new X({color:"#333333"}),font:"18px pingfang",textAlign:"center",textBaseline:"bottom",padding:[5,10,5,10],offsetX:-20,offsetY:-13,overflow:!0,rotateWithView:!1,rotation:0})});l&&Z(e,u=>l(u));const s=new O({geometry:new H(G(o)),type:"textPoint",...n});s.setStyle(i);const c=new V({source:new E({features:[s]}),zIndex:9});e.addLayer(c)},nt=(e,t,o,n,l=null)=>{let i=document.getElementById("popup"),s=document.getElementById("popup-closer");i.style.display="block";let c=new Ze({element:i,...l,zIndex:9999});e.addOverlay(c),s.onclick=()=>(c.setPosition(void 0),s.blur(),c=null,!1),c.setPosition(t),c.getElement().onclick=u=>{n(u)}},ze=(e,t,o)=>{let n=[];t.forEach(s=>{let c=te("rgba(32, 222, 230, 0.4)","rgba(255, 205, 67, 0.3)"),u=100;if(o){let{myCurveStyle:D,myCurveRadius:w}=o(s);c=D,u=w}let m=G(s.lonlat),P=en(m,u,100,45,s.curveData.antDirectionAngle),h=new O(P);h.setStyle(c),h.set("type","Curve"),h.set("curveData",s.curveData),n.push(h)});let l=new E;l.addFeatures(n);let i=new V({source:l,zIndex:1});e.addLayer(i)},Fe=(e,t,o,n)=>{nt(e,t,o,n,{autoPan:!0})},dn=(e,t,o)=>{const l={name:"通用信息展示弹窗",hdms:ke(e),coordinate:[t.longitude,t.latitude],popupData:t};o(l)},Me=(e,t)=>{let o=e.getLayers().getArray();for(let n=o.length-1;n>=0;--n)o[n]instanceof V&&t(o[n])},Le=e=>{Ye(),_e(e),Me(e,t=>{e.removeLayer(t)})},Z=(e,t)=>{Me(e,o=>{let n=o.getSource().getFeatures()[0];t(n)&&e.removeLayer(o)})},gn=(e,t)=>{Z(e,o=>{if(o)return o.get("type")===t})},ot=(e,t)=>{Z(e,o=>{if(o)return o.get("businessType")===t})},$e=e=>{Z(e,t=>{if(t)return(t.get("type")==="Marker"||t.get("type")==="Curve"||t.get("type")==="Cluster")&&!t.get("bussinessType")})},yn=e=>{Z(e,t=>{if(t)return t.get("tempType")}),Ye()},mn=(e,t)=>{e.getView().animate({center:G(t),duration:800})},fn=(e,t)=>{e.getLayers().forEach(o=>{let n=null;o&&(n=o.getSource()),n instanceof E&&n.forEachFeature(l=>{t(l)})})},wn=(e,t)=>{const n=new Kt({extractStyles:!1}).readFeatures(t);n.forEach(i=>{i.getGeometry().transform("EPSG:4326","EPSG:3857")});const l=new E({features:n});e.getView().fit(l.getExtent()),e.getLayers().push(new V({source:l,style:te("blue","red"),zIndex:100}))},hn=e=>{e.addInteraction(new Q({source:new E,type:"Polygon"})),e.getInteractions().getArray().forEach(t=>{t instanceof Q&&t.on("drawend",o=>{const{feature:n}=o,l=n.getGeometry(),i=l.getCoordinates()[0],s=l.transform("EPSG:3857","EPSG:4326").getCoordinates()[0];l instanceof be&&(at(e,{coords:i,lonlat:s},{drawType:"polygon"}),e.removeInteraction(t))})})},at=(e,{coords:t,lonlat:o,polygonData:n},l={},i,s=Qe())=>{let c=new O({geometry:new be([t]),type:"Polygon",...l,polygonData:{coords:t,lonlat:o,...n}});c.setStyle(s);let u=new V({source:new E({features:[c]})});e.addLayer(u),i&&i(c)},vn=e=>{},Pn=e=>{e.addInteraction(new Q({source:new E,type:"Circle"})),e.getInteractions().getArray().forEach(t=>{t instanceof Q&&t.on("drawend",o=>{const{feature:n}=o,l=n.getGeometry();let s={lonlat:pe(l.getCenter(),"EPSG:3857","EPSG:4326"),radius:l.getRadius()};rt(e,s,{drawType:"Circle"}),e.removeInteraction(t)})})},rt=(e,t,o={},n,l=!1)=>{t.radius||(t.radius=550);let i=[],s=new O({type:"Circle",...o,circleData:t,geometry:new Ot(G(t.lonlat),t.radius)});s.setStyle(l?new R({fill:new X({color:"rgba(255, 0, 0, 0)"}),stroke:new K({color:"#f00",color:"rgba(255, 0, 0, 0)"})}):Qe()),i.push(s);let c=new E;c.addFeatures(i);let u=new V({zIndex:100});if(u.setSource(c),e.addLayer(u),n){let m=0;u.on("postrender",P=>{m>=20&&(m=0);var h=(20-m)*(1/20),D=new R({radius:m,stroke:new K({color:"rgba(255,60,5"+h+")",width:18-m/1.5})});let w=Yt(P);w.setStyle(D),w.drawGeometry(s.getGeometry()),m=m+.2,e.render()})}},Cn=(e,t)=>{let o=new Q({source:new E,type:"LineString"});e.addInteraction(o),o.on("drawend",n=>{const{feature:l}=n,i=l.getGeometry();let s=Vt(i);s=s.toFixed(2);const c=i.getCoordinates(),u=i.transform("EPSG:3857","EPSG:4326").getCoordinates();t&&t(s),Je(e,c,{drawType:"TestDistance"}),tt(e,s+"米",u[0],{drawType:"TestDistance"})})},kn=e=>{Z(e,t=>{t.get("drawType")})},Ln=(e,t,o="../src/components/OpenlayerBaseMap/icon/routearrow.svg",n="arrowLine")=>{function l(i){const s=i.getGeometry(),c=s.getLength();let m=50*e.getView().getResolution(),P=Math.floor(c/m);const h=[new R({stroke:new K({color:"#42b983",width:6})})],D=[],w=[0];s.forEachSegment(function(v,S){let _=S[0]-v[0],p=S[1]-v[1],y=Math.atan2(p,_);w.unshift(Math.sqrt(_**2+p**2)+w[0]),D.push(y)});for(let v=1;v<P;v++){let S=s.getCoordinateAt(v*1/P);const _=v*m,p=w.findIndex(y=>y<=_);h.push(new R({geometry:new H(S),image:new qe({src:o,opacity:1,anchor:[.5,.5],rotateWithView:!0,rotation:-D[w.length-p-1],scale:.8})}))}return h}Je(e,t,{businessType:n},l)},bn=(e,t)=>{const o=[],n=new O({geometry:new H(t),name:Qt++,location:t,tempType:"myPointByMenu"}),l=new R({image:new ye({radius:15,fill:new X({color:"#409eff"}),stroke:new K({color:"#4440ff",width:1})})});n.setStyle(l),o.push(n);const i=new E({features:o}),s=new V({source:i,opacity:.8});e.addLayer(s)},st=(e,t,o="",n)=>{let l=document.createElement("div");l.className=`flicker_point ${o}`;let i=new Ze({element:l,position:t,zIndex:0});e.addOverlay(i),n&&l.addEventListener("click",()=>{n()})},_n=(e,t,o)=>{ee(o)},lt=()=>document.querySelector("#popup-content"),ie=(e,t)=>{f.emit("setCommonPopupInner",{popupObj:e,featureItem:t,callback:o=>{Ve(o,lt())}})},ue=(e,t)=>{let o=[];f.emit("setFeaturesPopupInner",{popupObj:e,callback:n=>{Ve(n,lt())},next:n=>{o=n}}),t&&t(o)},Mn={id:"popup",class:"ol-popup popup_toggle"},Tn={__name:"PopupCommon",props:{currentPageType:{type:String,default:""}},setup(e,{expose:t}){let o=M(!1),n={},l=M(null),i=M(null);const s=e;f.on("showPopupDialog",p=>{u(p,s.currentPageType)}),f.on("getSingleByFeatures",({unique:p,itemData:y})=>{let C=p.split(":");const{arrData:b}=y;n.arrData=b,b.forEach(F=>{F[C[0]]===C[1]&&(n.currentPopupData=F,ie(n),c(n))})}),f.on("popupBack",()=>{n.popupData=n.arrData,n.noFeature=!0,ue(n)});const c=p=>{let y=document.getElementById("popup-content");ie(p);const C=document.createElement("b");C.setAttribute("data-function","popupBack"),C.setAttribute("id","popupBack"),C.setAttribute("title","返回"),C.innerHTML="",y.appendChild(C)},u=(p,y)=>{switch(y){case"gis":he(()=>{l.value.show(p)});break;case"complain":he(()=>{i.value.show(p)});break}},m=()=>{o.value=!0},P=()=>{o.value=!1},h=(p,y,C,b)=>{let F=document.querySelector("#popupBack");F&&b&&!b.get("businessType")&&F.remove();let j=ee(y);const $={name:"通用信息展示弹窗",hdms:ke(y),coordinate:j,popupData:C};n=$,f.emit("fixCommonPopupData",$),Fe(p,y,ie($,b),fe=>{w(fe)})},D=(p,y,C)=>{let b=ee(y),F=ke(y),j=[];C.forEach($=>{switch($.get("type")){case"Marker":j.push("标注点");break;case"Curve":j.push("扇区");break}});const N={name:j.length+"个重叠要素",type:Array.from(new Set(j)).join(","),hdms:F,coordinate:b,popupData:C};n=N,Fe(p,y,ue(N,$=>{n.currentDataList=$}),$=>{w($)})},w=async p=>{const{target:y}=p;let C=y.getAttribute("data-function");C==="getMore"&&_(),C==="getSingleByFeatures"&&v(y.getAttribute("data-unique")),C==="popupBack"&&S()},v=p=>{if(!p)return;let y=p.split(":");const C=(b,F)=>{if(!b.get("noPopup")&&b.get(F)[y[0]]===y[1])return n.currentPopupData=b.get(F),b};n.currentPopupFeature=n.popupData.filter(b=>{switch(b.get("type")){case"Marker":return C(b,"pointData");case"Curve":return C(b,"curveData")}}),c(n,n.currentPopupFeature[0])},S=()=>{n.popupData instanceof Array&&ue(n)},_=()=>{f.emit("popupDataGetMore",{currentPopupObj:n,callback:p=>{u(p,s.currentPageType)}})};return t({showPopup:m,hidePopup:P,setCommonPopup:h,setFeaturesPopup:D}),(p,y)=>se((Y(),ce("div",Mn,y[0]||(y[0]=[L("div",{class:"popup_wrap"},[L("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"}),L("div",{id:"popup-content",class:"popup-content"})],-1)]),512)),[[le,W(o)]])}},Dn=me(Tn,[["__scopeId","data-v-42e9cbe9"]]),Sn={class:"lend_wrap"},xn={class:"lent_tb_wrap"},Bn=["title"],An={__name:"Lend",props:{currentPageType:{type:String,default:""},isShowLend:{type:Boolean,default:!0}},setup(e){f.on("showLend",()=>{t.value=!0});let t=M(!1);const o=()=>{t.value=!t.value};return(n,l)=>se((Y(),ce("section",Sn,[se(L("div",xn,null,512),[[le,W(t)]]),L("div",{class:"toggle",title:`点击${W(t)?"隐藏":"显示"}图例`,onClick:o},null,8,Bn)],512)),[[le,e.isShowLend]])}},En=me(An,[["__scopeId","data-v-5e3349e5"]]),zn={class:"switch_base_layer_wrap"},Fn={class:"switch_content"},$n=["title"],On={__name:"SwitchBaseLayer",emits:["switchBaseLayerType"],setup(e,{emit:t}){f.on("resetSwitchLayer",()=>{l.value.layerType="t3img"});const o=t;let n=M(!1);const l=M({layerType:"t3img"}),i=()=>{n.value=!n.value},s=c=>{o("switchBaseLayerType",c)};return(c,u)=>{const m=ne("el-radio"),P=ne("el-radio-group");return Y(),ce("section",zn,[se(L("div",Fn,[I(P,{modelValue:l.value.layerType,"onUpdate:modelValue":u[0]||(u[0]=h=>l.value.layerType=h),onChange:s},{default:q(()=>[I(m,{value:"t0vec"},{default:q(()=>u[1]||(u[1]=[oe("街道底图")])),_:1}),I(m,{value:"t3img"},{default:q(()=>u[2]||(u[2]=[oe("卫星(影像)底图")])),_:1}),I(m,{value:"t4ter"},{default:q(()=>u[3]||(u[3]=[oe("地形底图")])),_:1})]),_:1},8,["modelValue"])],512),[[le,W(n)]]),L("div",{class:"toggle",title:`点击${W(n)?"隐藏":"显示"}`,onClick:i},null,8,$n)])}}},Vn=me(On,[["__scopeId","data-v-0273d3a5"]]),In={class:"dialog_wrap"},Gn={key:0},Rn={__name:"SetTokenDialog",setup(e,{expose:t}){const{setMapToken:o}=ve();ve();let n=M("6b94eac741fe8a50f283b9b11d9d60d2");const l=M(null),i=M(""),s=M([]),c=(w,v)=>{const S=w?s.value.filter(u(w)):s.value;v(S)},u=w=>v=>v.value.toLowerCase().indexOf(w.toLowerCase())===0,m=()=>[{name:"token1",value:"02dd5ea16a6b869b3b37e12f269b1463"},{name:"token2",value:"53ce309465e600f242d351b15013397f"},{name:"token3",value:"37c72a79fe4c6a1b3fa6b1435214b378"},{name:"token4",value:"5a257cd2df1b3311723bd77b0de14baf"},{name:"token5",value:"7786923a385369346d56b966bb6ad62f"}],P=w=>{o(w.value)},h=()=>{if(i.value.length!==32){Oe.warning("请输入正确的token");return}f.emit("initOlMapByToken"),f.emit("resetSwitchLayer"),l.value.hide(),n.value=i.value};return Ie(()=>{s.value=m()}),t({show:w=>{l.value.show(),l.value.setDialogWidth("30%"),i.value=""}}),(w,v)=>{const S=ne("el-autocomplete"),_=ne("el-button"),p=ne("dialog-info");return Y(),Ge(p,{ref_key:"refDialogInfo",ref:l,class:"dialog_info_wrap",isShowFotter:!0},{DialogTitle:q(()=>v[1]||(v[1]=[L("span",null,"切换天地图token",-1)])),DialogContainer:q(()=>[L("div",In,[L("p",null,"当前token: "+ae(W(n)),1),I(S,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=y=>i.value=y),style:{width:"65%"},"fetch-suggestions":c,"popper-class":"my-autocomplete",placeholder:"请选择或者输入",onSelect:P,clearable:""},{suffix:q(()=>v[2]||(v[2]=[])),default:q(({item:y})=>[L("div",{class:Mt(["input_wrap",{current_selected:y.value===W(n)}])},[L("h3",null,[oe(ae(y.name)+" ",1),y.value===W(n)?(Y(),ce("span",Gn,"- 当前token")):Tt("",!0)]),L("span",null,ae(y.value),1)],2)]),_:1},8,["modelValue"]),I(_,{type:"primary",style:{"margin-left":"25px"},onClick:h,disabled:i.value===""},{default:q(()=>v[3]||(v[3]=[oe(" 确定 ")])),_:1},8,["disabled"])])]),_:1},512)}}},Zn=me(Rn,[["__scopeId","data-v-e0d3be93"]]),qn={class:"ol_map_wrap"},jn={class:"copyright_info"},Nn=xt({name:"gis"}),Un=Object.assign(Nn,{props:{currentPageType:{type:String,default:""},isAutoRenderData:{type:Boolean,default:!1},isShowLend:{type:Boolean,default:!0}},emits:["getOlMapInstance","getCurrentViewData","reflashMap","toggleOverviewInfo","getCircleData","setCircleDialogData"],setup(e,{expose:t,emit:o}){const n=o,l=e,{proxy:i}=Bt();let s=null;const c=M(null),u=M(null),m=M(null);M(!0);const P=M(0),h=M(""),D=M(!0);let w=M({});const v={minRenderZoom:we},S=a=>{s=a,n("getOlMapInstance",a,v),rn(a),sn(a,r=>{_(r)},r=>{r(l.currentPageType)})},_=({option:a,feature:r,pixelPoint:g})=>{c.value.hidePopup(),z.setMenuMethods(s,a,r,g,i)},p=a=>{l.isAutoRenderData||n("getCurrentViewData",a),n("getCircleData",a)},y=a=>{j(a)},C=a=>{on(s,a)},b=(a,r,g,d=!0)=>{c.value.hidePopup(),D.value&&De(s),setTimeout(()=>{d?r.forEach(k=>{g(a,k)}):g(a,r)},500)},F=async(a,r,g,d)=>{const{arrData:k}=r;g&&g(r),c.value.hidePopup(),a.getView().setZoom(18),Se(s,[r.longitude,r.latitude]),Le(s),d&&d(a,[r]),setTimeout(()=>{fn(a,B=>{let T={};switch(B.get("type")){case"Marker":T=B.get("pointData");break;case"Curve":T=B.get("curveData");break}T.cgi===r.cgi&&(w.value={featureData:T,featureItem:B})})},1e3);const x=Te(r.longitude,r.latitude);dn(x,r,B=>{if(k)B.popupData=k,B.noFeature=!0;else{let T=document.querySelector("#popupBack");T&&T.remove()}nt(a,x,k?ue(B):ie(B),T=>{const{target:J}=T;J.getAttribute("data-function")==="getMore"&&f.emit("popupDataGetMore",{currentPopupObj:r,callback:bt=>{f.emit("showPopupDialog",bt)}}),J.getAttribute("data-function")==="getSingleByFeatures"&&f.emit("getSingleByFeatures",{unique:J.getAttribute("data-unique").trim(),itemData:r}),J.getAttribute("data-function")==="popupBack"&&f.emit("popupBack")})})};f.on("initOlMapByToken",()=>{xe()}),f.on("reflashMap",a=>{a&&s.getView().getZoom()>we&&f.emit("resetBtn"),yn(s),n("reflashMap",a,()=>{he(()=>{setTimeout(()=>{if(!Dt(w.value)){let{featureData:r,featureItem:g}=w.value;et(s,g)}},1e3)})})}),f.on("cancelDrawInteraction",()=>{Z(s,a=>a.get("drawType")),_e(s)}),f.on("drawPolygon",()=>{hn(s)}),f.on("cancelPolygon",()=>{vn(s)}),f.on("drawCircle",()=>{Pn(s)}),f.on("cancelCircle",()=>{}),f.on("testDistance",a=>{Cn(s,a)}),f.on("cancelTestDistance",()=>{kn(s)}),f.on("showSetTokenDialog",()=>{var a;(a=m.value)==null||a.show()}),f.on("singleFeaturesClick",({feature:a,pixelPoint:r})=>{if(l.currentPageType==="complain"){n("setCircleDialogData",a);return}N(s,a,r)});const j=a=>{a.on("pointermove",r=>{let g=a.getEventPixel(r.originalEvent),d=a.hasFeatureAtPixel(g);a.getTargetElement().style.cursor=d?"pointer":"",h.value=ee(r.coordinate)}),a.on("singleclick",r=>{if(ge(a))return;c.value.hidePopup(),He();let g=a.getEventPixel(r.originalEvent),d=a.getFeaturesAtPixel(g);const k=T=>d.filter(J=>J.get("type")===T),x=T=>JSON.stringify(k(T))!=="[]",B=()=>{let T=k("Marker")[0]||k("Curve")[0];d.length===2?T&&T.get("type")&&N(s,T,r.coordinate):c.value.setFeaturesPopup(a,r.coordinate,d)};d&&(d.length===1&&(k("Circle").length!==0&&c.value.hidePopup(),N(a,d[0],r.coordinate)),d.length>1&&(x("Cluster")&&(c.value.hidePopup(),N(a,d[0],r.coordinate)),(x("Circle")||x("Polygon"))&&B(),x("Circle")||x("Polygon")||(d[0].get("type")==="Curve"||d[0].get("type")==="Marker")&&c.value.setFeaturesPopup(a,r.coordinate,d)))}),a.on("moveend",r=>{let g=s.getView(),d=g.getZoom();P.value=d.toFixed(2);let k=g.getCenter();f.emit("getCurrentCenter",ee(k)),f.emit("getCurrentZoom",{zoom:d,minRenderZoom:we}),l.isAutoRenderData&&($e(a),n("getCurrentViewData",a))})},N=(a,r,g)=>{if(r&&r.get("drawType")&&ge(a))return;let d=null;if(r&&r.get("type")==="Cluster"){c.value.hidePopup();let k=r.get("features");if(k.length===1){d=k[0].get("pointData"),c.value.setCommonPopup(a,g,d,k[0]);return}const x=Jt(k.map(B=>B.getGeometry().getCoordinates()));a.getView().fit(x,{duration:1e3,padding:[50,50,50,50]})}r&&r.get("type")==="Marker"&&(d=r.get("pointData"),c.value.setCommonPopup(a,g,d,r)),r&&r.get("type")==="Curve"&&(d=r.get("curveData"),c.value.setCommonPopup(a,g,d)),r&&r.get("type")==="Circle"&&$(r),r&&r.get("type")==="Polygon"&&(r.get("polygonData"),r.get("businessType"),fe(r))},$=a=>{let r=a.get("circleData");f.emit("setCircleDialogData",r)},fe=a=>{const{coords:r,lonlat:g,name:d}=a.get("polygonData");f.emit("setPolygonDialogData",{lonlat:g,name:d})},ct=a=>an(a),Te=(a,r)=>ln(a,r),it=(a,r,g={},d,k)=>{rt(a,r,g,d,k)},ut=(a,r,g,d)=>{st(a,r,g,d)},pt=(a,r)=>{wn(a,r)},dt=a=>{Le(a)},gt=(a,r)=>{gn(a,r)},yt=(a,r)=>{ot(a,r)},mt=(a,r,g,d={},k)=>{un(a,r,g,d,k)},ft=(a,r,g)=>{pn(a,r,g)},De=a=>{$e(a)},wt=(a,r)=>te(a,r),ht=(a,r,g)=>{g?ze(a,r,d=>g(d)):ze(a,r)},Se=(a,r)=>{mn(a,r)},vt=(a,{coords:r,lonlat:g,polygonData:d},k,x,B)=>{at(a,{coords:r,lonlat:g,polygonData:d},k,x,B)},Pt=(a,r,g,d,k={},x)=>{tt(a,r,g,{businessType:d,...k},x)},Ct=a=>cn(a),kt=(a,r,g,d)=>{Ln(a,r,g,d)},xe=()=>{Lt(s);const a=nn("olMap");S(a),p(a),y(a)},Lt=a=>{a&&tn(a)};return Ie(()=>{xe()}),t({renderFeatureByData:b,setMapByAutoPopupData:F,getCurrentViewPosition:ct,transformToPixelPoint:Te,addCircle:it,addFlickerPoint:ut,loadKML:pt,removeAllLayer:dt,removeLayerByType:gt,removeLayerByBusinessType:yt,addPoint:mt,setCluster:ft,removeAllDefaultLayer:De,addCurve:ht,createPolygon:vt,flyToCoordinate:Se,setFeaturesStyle:wt,addTextPoint:Pt,getPolygonCenter:Ct,addArrowLine:kt}),(a,r)=>(Y(),ce("section",qn,[St(a.$slots,"default"),r[3]||(r[3]=L("section",{id:"olMap",class:"ol_map"},null,-1)),I(En,{ref_key:"refLend",ref:u,currentPageType:e.currentPageType,isShowLend:e.isShowLend},null,8,["currentPageType","isShowLend"]),I(Vn,{onSwitchBaseLayerType:C}),I(Dn,{ref_key:"refPopupCommon",ref:c,currentPageType:e.currentPageType},null,8,["currentPageType"]),se(L("div",jn,[r[2]||(r[2]=L("p",null,"Copyright © CMDI.vip All Rights Reserved.",-1)),L("ul",null,[L("li",null,[L("dl",null,[r[0]||(r[0]=L("dt",null,"经纬度：",-1)),L("dd",null,ae(h.value),1)])]),L("li",null,[L("dl",null,[r[1]||(r[1]=L("dt",null,"当前层级：",-1)),L("dd",null,ae(P.value),1)])])])],512),[[le,!0]]),I(Zn,{ref_key:"refSetTokenDialog",ref:m},null,512)]))}}),Hn={__name:"index",setup(e){const t=M(null);let o=null,n=null;const l=(c,u)=>{o=c,n=u},i=async c=>{s(c)},s=c=>{let u=t.value.getCurrentViewPosition(c);return{minLatitude:u.bottomRight[1],maxLatitude:u.topLeft[1],minLongitude:u.topLeft[0],maxLongitude:u.bottomRight[0]}};return(c,u)=>(Y(),Ge(Un,{class:"empty_map",ref_key:"refOpenlayerBaseMap",ref:t,isShowLend:!1,currentPageType:"empty-map",onGetOlMapInstance:l,onGetCurrentViewData:i},null,512))}};export{Hn as default};
